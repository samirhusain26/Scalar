# Scalar - Project Context

> **Maintenance rule**: When making significant changes (new files, new dependencies, architecture changes, new features), update this file to reflect those changes before committing.

## What Is This Project?
Scalar is a client-side deductive logic guessing game (similar to Wordle but with numerical attributes). Players guess entities (countries, movies, chemical elements, animals) and receive feedback via multiple logic systems — directional arrows, proximity tiers, geographic distance, category matching, and set intersection — to deduce the target. Features a "Total Moves" scoring system where players try to minimize their move count.

## Repository Layout
```
Scalar/                              # Git root
├── CLAUDE.md                        # THIS FILE - project context
├── README.md                        # Project documentation
├── GAMEPLAY.md                      # Detailed gameplay logic & scoring documentation
├── STYLE_GUIDE.md                   # Visual design system & component specifications
├── .gitignore
├── credentials.json                 # Google Service Account (DO NOT COMMIT - gitignored)
├── fetch_data.py                    # Python script: CSV files -> gameData.json
├── enrich_hollywood.py              # Python script: enrich Hollywood movie data
├── package.json                     # npm package (scalar, private)
├── package-lock.json
├── vite.config.ts                   # Vite build config (@ alias -> src/)
├── tsconfig.json                    # TypeScript root config (references app/node)
├── tsconfig.app.json                # App TS config (ES2022, strict)
├── tsconfig.node.json               # Node TS config (ES2023)
├── eslint.config.js                 # ESLint flat config (v9)
├── postcss.config.js                # PostCSS: @tailwindcss/postcss + autoprefixer
├── components.json                  # Shadcn CLI config
├── index.html                       # HTML entry point
├── data/                            # Source data files for game content
│   ├── countries_schema_config.csv  # Countries schema definition
│   ├── countries_enriched.csv       # Countries entity data
│   ├── hollywood_schema_config.csv  # Hollywood schema definition
│   ├── hollywood_enriched.csv       # Hollywood entity data
│   ├── chemicals_schema_config.csv  # Chemicals schema definition
│   ├── chemicals_enriched.csv       # Chemicals entity data (not tracked)
│   ├── animals_schema_config.csv    # Animals schema definition
│   ├── animals_enriched.csv         # Animals entity data
│   ├── enrich_countries.py          # Data enrichment script for countries
│   ├── categorize_countries.py      # Country categorization script
│   ├── enrich_hollywood.py          # Data enrichment script for Hollywood
│   ├── clean_animals.py             # Data cleaning script for animals
│   └── clean_chemicals.py           # Data cleaning script for chemicals
└── src/                             # React/TypeScript source
    ├── main.tsx                     # Entry point: StrictMode, imports Geist Mono + Fraunces fonts + index.css
    ├── App.tsx                      # Root component: header, category selector, scoreboard, grid, input, modals
    ├── index.css                    # Tailwind v4 config + CSS custom properties + custom utilities
    ├── types.ts                     # All shared types: DataType, LogicType, DisplayFormat, UIColorLogic, SchemaField, Entity, Feedback, etc.
    ├── assets/
    │   └── data/gameData.json       # Static game data: schema definitions + entity data per category (auto-generated by fetch_data.py)
    ├── store/
    │   └── gameStore.ts             # Zustand store: single source of truth, localStorage persistence (version 12)
    ├── utils/
    │   ├── gameLogic.ts             # Pure functions: getFeedback (dispatch by logicType), checkWinCondition, etc.
    │   ├── feedbackColors.ts        # Shared color helpers: getGeoDistanceCellClass, getCategoryMatchClass, getStandardStatusClass, getCellColor
    │   ├── formatters.ts            # formatNumber(), formatDistance(), formatPercentageDiffTier(), formatYearDiffTier(), expandConservationStatus(), getDirectionSymbol(), getAlphaDirectionSymbol(), numberToLetter()
    │   ├── geo.ts                   # haversineDistance(): great-circle distance between coordinates
    │   ├── schemaParser.ts          # getDisplayColumns(), getFoldedColumns(), getVisibleCandidateColumns(), getFieldByKey()
    │   ├── challengeUtils.ts        # encodeChallenge(), decodeChallenge(): Base64 challenge URL encoding/decoding
    │   ├── analytics.ts             # trackGameEvent(): wrapper for Vercel Analytics event tracking
    │   └── cn.ts                    # cn(): clsx + tailwind-merge utility
    └── components/
        ├── ui/                      # Shadcn/UI primitives (button, card, dialog, input)
        ├── GameGrid.tsx             # Responsive card grid: CSS Grid container, manages MajorHintModal
        ├── GuessCard.tsx            # Individual guess card: header, main attribute grid, expandable folded section, major-hint interactions
        ├── GameInput.tsx            # Autocomplete input: tag cloud suggestions opening downward, keyboard nav
        ├── GameOverModal.tsx        # Radix Dialog: bottom-sheet on mobile, centered on desktop. Share + Play Again
        ├── HowToPlayModal.tsx       # Radix Dialog: gameplay instructions, auto-opens on first visit (localStorage: scalar-htp-seen)
        ├── MajorHintModal.tsx       # Radix Dialog: confirmation for hint reveal (free with credits, +3 moves without)
        ├── PrivacyPolicyModal.tsx   # Radix Dialog: privacy policy with Vercel Analytics disclosure
        ├── RevealAnswerModal.tsx    # Radix Dialog: shows target entity + all attribute values on forfeit
        ├── ScalarLogo.tsx           # Venn diagram SVG logo component
        ├── VennBackground.tsx       # Animated decorative background SVG with venn diagram orbs
        └── Scoreboard.tsx           # Header display: moves count, free hint credit indicators (3 filled/empty squares)
```

## Tech Stack
- **React 19** with **TypeScript ~5.9** (strict mode, `noUnusedLocals`, `noUnusedParameters`)
- **Vite 7** for build/dev (`npm run dev` / `npm run build`)
- **Tailwind CSS v4** (uses `@theme inline` syntax in CSS, NOT `tailwind.config.js`)
- **Zustand 5** for state management with localStorage persistence
- **Shadcn/UI** (Radix UI primitives) for base components
- **Lucide React** for icons (Eye, Check, ChevronDown, Share2)
- **Vercel Analytics** (`@vercel/analytics`) for privacy-respecting usage analytics (no cookies, daily-reset hash)
- **Fraunces Variable** serif font for display headings (via `@fontsource-variable/fraunces`)
- **Geist Mono** for data, clues, and body text (monospace aesthetic)

## Key Commands
All commands run from repo root:
```bash
npm run dev       # Vite dev server at http://localhost:5173
npm run build     # tsc -b && vite build -> dist/
npm run lint      # ESLint (flat config, v9)
npm run preview   # Preview production build
```

Data fetch (reads CSVs from `data/`, writes `gameData.json`):
```bash
python fetch_data.py
```

## Architecture Pattern (Strict Separation of Concerns)
1. **Types** (`src/types.ts`) - All shared interfaces/types
2. **Pure Logic** (`src/utils/gameLogic.ts`) - Game mechanics as pure functions, NO state mutation
3. **State** (`src/store/gameStore.ts`) - Zustand store calls pure functions, updates state
4. **Components** (`src/components/`) - Consume state via `useGameStore`, render UI

**Data flow**: User action -> Component dispatches store action -> Store calls pure function from gameLogic -> Store updates state -> Components re-render -> localStorage persisted automatically

## Type System (`types.ts`)

### LogicType (how feedback is computed per field)
| LogicType | Purpose | Example Fields |
|-----------|---------|----------------|
| `EXACT_MATCH` | Binary exact equality | Driving Side, Landlocked?, Radioactive |
| `CATEGORY_MATCH` | String match, optionally colored by distance gradient | Continent, Subregion, Hemisphere, Production Co. |
| `HIGHER_LOWER` | Numeric comparison with direction + percentage diff | Population, Area, GDP, Atomic #, Year |
| `GEO_DISTANCE` | Haversine distance between coordinates | Distance (virtual field in Countries) |
| `SET_INTERSECTION` | Intersection of comma-separated lists | Genre, Cast & Crew |
| `TARGET` | Entity name (identification only) | Country Name, Movie Title |
| `NONE` | Support/hidden column (not displayed) | Latitude, Longitude, category columns |

### DisplayFormat (how cell values render)
| Format | Rendering |
|--------|-----------|
| `HIDDEN` | Column not displayed in grid |
| `TEXT` | Raw string value |
| `DISTANCE` | Formatted km distance (e.g., "1,234 km") |
| `PERCENTAGE_DIFF` | Direction arrow + tier (e.g., "↑ ~25%") |
| `RELATIVE_PERCENTAGE` | Direction arrow + relative % (e.g., "↑ +34%") |
| `NUMBER` | Raw numeric value |
| `CURRENCY` | Direction arrow + $-prefixed value |
| `LIST` | Intersection count "X/Y" |
| `ALPHA_POSITION` | Letter character (1→A, 2→B, ..., 26→Z) with horizontal arrow direction |

### UIColorLogic (how cell background is determined)
| Logic | Coloring |
|-------|----------|
| `DISTANCE_GRADIENT` | Green if exact text match, white if miss (for location text fields like Continent/Subregion/Hemisphere) |
| `CATEGORY_MATCH` | Green if exact, gold if linked category matches, white if miss |
| `STANDARD` | Thermal EXACT/HOT/NEAR/MISS colors (green/orange/amber-dashed/white) |
| `NONE` | No special coloring |

### SchemaField Interface
```typescript
interface SchemaField {
    attributeKey: string;         // Column key in entity data
    displayLabel: string;         // Human-readable header label
    dataType: DataType;           // INT, FLOAT, STRING, CURRENCY, BOOLEAN, LIST
    logicType: LogicType;         // How feedback is computed
    displayFormat: DisplayFormat; // How the cell renders
    isFolded: boolean;            // Placed in expandable "More clues" section (no penalty)
    isVirtual: boolean;           // Computed field (e.g., distance_km)
    linkedCategoryCol?: string;   // Category column for HIGHER_LOWER status coloring
    uiColorLogic?: UIColorLogic;  // Override cell color logic
}
```

### Feedback Interface
```typescript
interface Feedback {
    direction: FeedbackDirection;     // UP, DOWN, EQUAL, NONE
    status: FeedbackStatus;           // EXACT, HOT, NEAR, MISS
    value: string | number | boolean; // Raw guess value
    displayValue?: string;            // Formatted display string
    distanceKm?: number;              // For GEO_DISTANCE / DISTANCE_GRADIENT
    percentageDiff?: number;          // For HIGHER_LOWER
    categoryMatch?: boolean;          // For linked category coloring
    matchedItems?: { text: string; isMatch: boolean }[]; // For SET_INTERSECTION per-item match status
}
```

## Component Details

### App.tsx
- Derives `CATEGORIES` from `gameData.categories` keys
- Renders header bar with: category `<select>` dropdown (left), GameInput (center), Scoreboard + "How to Play" link (right)
- **Mobile layout**: stacked rows (category dropdown, input, score+HTP), all centered
- **Desktop layout**: single row with absolutely centered input
- Header separated by venn gradient underline (`border-b-venn`)
- "How to Play" link opens HowToPlayModal (auto-opens on first visit via localStorage `scalar-htp-seen`)
- Win effect: briefly adds `invert` class to `<html>` on SOLVED status
- Answer display: shows `??????` while PLAYING, reveals name (truncated to 12 chars) when solved/revealed
- "Reveal Answer" button during PLAYING triggers `revealAnswer()` -> REVEALED state
- RevealAnswerModal receives active category schema for attribute display
- **Footer**: "Built by Samir Husain" link + "Privacy Policy" button opening PrivacyPolicyModal
- **Share challenge button**: fixed bottom-right button with Share2 icon, generates challenge URL via `encodeChallenge()`, uses Web Share API or clipboard
- **Vercel Analytics**: `<Analytics>` component rendered at root level (debug mode in development)

### GameGrid.tsx
- Responsive CSS Grid container: `grid-cols-1` (mobile), `md:grid-cols-2` (tablet), `xl:grid-cols-3` (desktop)
- Uses `getDisplayColumns()` from schemaParser to get visible fields
- Renders `GuessCard` components for each guess, most recent first (reversed order)
- No empty placeholder rows — only actual guesses are rendered
- Manages `MajorHintModal` confirmation state (pendingMajorHint accepts `string | string[]`)

### GuessCard.tsx
- Renders a single guess as a data card with header + main attribute grid + expandable folded section
- **Header**: Entity name (bold uppercase, left) + guess index `#03` format (right), `border-b border-charcoal`
- **Main grid**: `grid grid-cols-2 gap-px bg-charcoal` — non-folded attributes with thin internal dividers
- **Merged Location cell**: Continent, Subregion, Hemisphere merged into a single col-span-2 row showing "Hemisphere • Continent • Subregion" with dot separators. All exact = green bg. Partial = white bg with green text on matches, opacity-50 on misses. Hint reveals all 3 attributes at once.
- **HIGHER_LOWER cells**: Split layout — value on left, arrow+tier on right. Year fields use absolute year diff tiers (±2 yrs, ±5 yrs, etc.) instead of percentage. Large percentage diffs use multiplier tiers (2x+, 5x+, 10x+, 50x+, 100x+).
- **Olympics Hosted cell**: Custom rendering — merges hosted count with last year in format "3 (2020)". Custom amber coloring when last years are within 8 years.
- **List (SET_INTERSECTION)**: Full-width (col-span-2) rows for Genre/Cast & Crew. Shows comma-separated values with per-item match coloring (green+bold for matches, gray for misses). Truncated to 2 lines via `line-clamp-2`. Cast & Crew only shows matched items; hidden entirely if no matches.
- **N/A handling**: Missing values (-1, null, empty) render as "N/A" in gray italic on white bg.
- **Conservation status**: IUCN codes (LC, EN, CR, etc.) expanded to full labels (Least Concern, Endangered, etc.)
- **ALPHA_POSITION**: Numeric values (1-26) rendered as letters (A-Z) with horizontal arrows (←/→)
- **Scrabble score**: Displayed as "14 pts" or "14 pts · 2w" for multi-word names
- **Animal units**: Weight shows "kg", Height shows "cm", Lifespan shows "yrs", Speed shows "km/h"
- **Expandable section**: Folded attributes (`isFolded: true`) in a collapsible "More clues" / "Hide clues" section with ChevronDown toggle. Local `useState<boolean>` per card, default collapsed.
- **All cells**: Show Eye icon button (top-right, opacity-40) to trigger hint reveal (free with credits, +3 moves without)
- **Hinted cells**: Show inverted target value badge (bg-charcoal text-paper-white, Check icon)
- Uses `getCellColor()` from `feedbackColors.ts` for all color logic
- Card aesthetic: `border border-charcoal bg-paper-white`, no shadows, no rounded corners

### GameInput.tsx
- Autocomplete with downward-opening tag cloud suggestions (opens below input with arrow caret)
- Keyboard navigation: ArrowUp/Down to navigate, Enter to select, Escape to close
- Disabled with "Solved" or "Revealed" placeholder when game is SOLVED or REVEALED
- Suggestions limited to 8 items, deduplicated by name
- Underline-style input: `border-0 border-b-2 border-b-charcoal`, no box, `bg-transparent`, `px-0`
- Width: `w-48` (mobile), `w-56` (desktop)

### GameOverModal.tsx
- Radix Dialog with bottom-sheet animation on mobile, centered modal on desktop
- Title: "Puzzle Complete"
- Shows target entity name, total moves
- Share button: builds emoji grid (green/yellow/black squares), uses Web Share API if available, falls back to clipboard
- "Play Again" button to reset

### RevealAnswerModal.tsx
- Radix Dialog: bottom-sheet on mobile, centered on desktop
- Title: "Answer Revealed"
- Uses `getDisplayColumns()` to show all target entity attributes in a scrollable list
- Formats numbers, booleans, and strings per type
- "New Game" button to reset

### HowToPlayModal.tsx
- Auto-opens on first visit (localStorage key: `scalar-htp-seen`)
- Sections: Goal, How It Works, Feedback Colors (with swatches), Direction Indicators, Scoring, Hints
- Responsive: bottom-sheet on mobile, centered modal on desktop

### MajorHintModal.tsx
- Confirmation dialog for hint reveal
- Shows dynamic cost: "free" if credits available, "+3 moves" otherwise
- Buttons: Cancel, Reveal (Free) / Reveal (+3)

### PrivacyPolicyModal.tsx
- Radix Dialog: always centered (no bottom-sheet variant), `max-w-2xl`
- Sections: Information We Collect (local storage, Vercel Analytics), Information We Do Not Collect, Third-Party Services, Data Retention, Contact
- Explains cookie-free analytics, local-only game state, daily-reset hash identification
- "Got It" close button, matches modal design system (charcoal title banner, serif font)

### Scoreboard.tsx
- Right side of header bar
- Displays: Moves count, free hint credit indicators (filled/empty squares)

## Store (gameStore.ts)
```
State:
  activeCategory: string                  (default: 'countries')
  targetEntity: Entity                    (random on init/reset)
  guesses: GuessResult[]
  gameStatus: 'PLAYING' | 'SOLVED' | 'REVEALED'
  moves: number                           (total moves count, lower is better)
  credits: number                         (free hint credits, default: 3)
  majorHintAttributes: string[]           (tracks which attrs have been major-hinted)

Actions:
  setActiveCategory(cat) -> full reset with new target, new column visibility, resets moves/credits
  submitGuess(entity) -> computes feedback, increments moves +1, checks win; tracks game_completed event via Vercel Analytics on SOLVED
  revealMajorHint(attr | attr[]) -> reveals exact target value; uses credit if available (0 moves), else +3 moves. Accepts single key or array (for location batch).
  revealAnswer() -> forfeit: set status to REVEALED, moves set to total entity count in category
  resetGame() -> new target, clear guesses, keep category, reset moves to 0 and credits to 3
  startChallengeGame(category, entity) -> reset state and set exact category + target entity (for challenge URLs)
```

Persisted to localStorage under key `scalar-game-storage` (version 11 with migration).

## Game Logic (gameLogic.ts) — Feedback Engine

The feedback system uses a **dispatch pattern** based on each field's `logicType`:

```
getFeedback(target, guess, schema)
  ├── Pre-computes haversine distance (for DISTANCE_GRADIENT fields)
  └── For each schema field:
      ├── EXACT_MATCH   → handleExactMatch()
      ├── CATEGORY_MATCH → handleCategoryMatch()
      ├── HIGHER_LOWER  → handleHigherLower()
      ├── GEO_DISTANCE  → handleGeoDistance()
      └── SET_INTERSECTION → handleSetIntersection()
```

### Handler Functions

| Handler | Logic | Status Rules | Display |
|---------|-------|-------------|---------|
| `handleExactMatch` | Binary equality (case-insensitive strings, boolean) | EXACT or MISS | Raw value (booleans show "Yes"/"No") |
| `handleCategoryMatch` | String equality; attaches `distanceKm` when `uiColorLogic === 'DISTANCE_GRADIENT'` | EXACT or MISS | Raw value |
| `handleHigherLower` | Numeric comparison; computes `percentageDiff`; checks `linkedCategoryCol` for status | EXACT if equal; HOT if linked category matches; MISS otherwise | Arrow + tier/percentage/currency per displayFormat |
| `handleGeoDistance` | Uses pre-computed haversine distance | EXACT (0km), HOT (<1000km), NEAR (<3000km), MISS (>=3000km) | Formatted distance string |
| `handleSetIntersection` | Comma-separated list intersection-over-union ratio | EXACT (ratio=1), HOT (>0.5), NEAR (>0), MISS (0) | "X/Y" intersection count |

### Utility Functions

| Function | Purpose |
|----------|---------|
| `getRandomTarget(gameData, category)` | Random entity from category |
| `checkWinCondition(feedback)` | Returns true if ALL statuses are EXACT |
| `getSuggestions(entities, query, guessedIds)` | Fuzzy match for autocomplete (max 8) |
| `getInitialColumnVisibility(schema)` | Sets all non-folded display columns to visible |

### Supporting Utilities

**feedbackColors.ts:**
| Function | Purpose |
|----------|---------|
| `getGeoDistanceCellClass(distanceKm)` | Returns Tailwind classes for GEO_DISTANCE cells: green (<1000km), amber (<3000km), yellow (<5000km), white (>=5000km) |
| `getCategoryMatchClass(categoryMatch)` | Returns `bg-cat-match` (gold) or `bg-white text-charcoal` |
| `getStandardStatusClass(status)` | Returns thermal status classes: green (EXACT), orange (HOT), amber-dashed (NEAR), white (MISS) |
| `getCellColor(feedback, field)` | Composite dispatcher: picks color strategy based on `uiColorLogic` and feedback |

**challengeUtils.ts:**
| Function | Purpose |
|----------|---------|
| `encodeChallenge(categoryId, entityId)` | Creates Base64 string from `{c, i}` JSON payload for challenge URLs |
| `decodeChallenge(hash)` | Decodes Base64, validates category and entity exist in gameData, returns `{category, entity}` or `null` |

**formatters.ts:**
| Function | Purpose |
|----------|---------|
| `formatNumber(num, digits)` | Converts to k/M/B/T/P/E suffixed strings |
| `formatDistance(km)` | Formats distance (e.g., "1,234 km", "1.5M km") |
| `formatPercentageDiffTier(percentDiff)` | Buckets into tiers: "Exact", "~10%", "~25%", "~50%", "~100%", then multiplier tiers: "2x+", "5x+", "10x+", "50x+", "100x+" |
| `formatYearDiffTier(absDiff)` | Absolute year diff tiers: "Exact", "±2 yrs", "±5 yrs", "±10 yrs", "±25 yrs", "±50 yrs", "50+ yrs" |
| `expandConservationStatus(code)` | Expands IUCN codes to labels: LC→Least Concern, EN→Endangered, CR→Critically Endangered, etc. |
| `getDirectionSymbol(direction)` | Returns "↑" for UP, "↓" for DOWN, "" otherwise |
| `getAlphaDirectionSymbol(direction)` | Returns "→" for UP (later in alphabet), "←" for DOWN (earlier), "" otherwise |
| `numberToLetter(num)` | Converts 1-26 to A-Z letter character |

**analytics.ts:**
| Function | Purpose |
|----------|---------|
| `trackGameEvent(name, data)` | Wrapper for Vercel Analytics `track()` — used in gameStore to track game completions (category, moves, hints used) |

**geo.ts:**
| Function | Purpose |
|----------|---------|
| `haversineDistance(lat1, lon1, lat2, lon2)` | Great-circle distance in km using Haversine formula |

**schemaParser.ts:**
| Function | Purpose |
|----------|---------|
| `getDisplayColumns(schema)` | Fields where `displayFormat !== 'HIDDEN'` |
| `getFoldedColumns(schema)` | Fields where `isFolded === true` |
| `getVisibleCandidateColumns(schema)` | Display fields that are NOT folded (for initial visibility randomization) |
| `getFieldByKey(schema, key)` | Lookup by `attributeKey` |

## Scoring System (Total Moves)
- **+1 move** per guess submitted
- **Hints** (eye icon on any attribute): Free if credits > 0 (consumes 1 credit), else **+3 moves**
- **Free hint credits**: 3 per game (displayed as filled squares in Scoreboard)
- **Forfeit**: Reveal Answer ends game as REVEALED, moves set to total entity count in category

## Hint Systems
- All non-folded display columns are visible by default on every guess card

### Free Hint Credits
- Player starts each game with 3 free hint credits
- Credits are consumed when revealing columns, folded attributes, or using eye-icon hints
- Displayed in Scoreboard as 3 filled/empty squares
- Reset to 3 on new game or category change

### Folded Attributes (Expandable Section)
- Schema fields marked `isFolded: true` are rendered in a collapsible "More clues" section at the bottom of each guess card
- Toggle button with ChevronDown icon; local `useState` per card (default collapsed)
- Folded fields render as normal feedback cells with full color logic when expanded
- Folded attribute reveals use the same credit/moves logic as hints

### Hints (Eye Icon)
- Eye icon on ALL cells within each guess card (top-right corner), including the merged Location cell
- Clicking triggers MajorHintModal for confirmation
- Uses credit if available (free), else costs +3 moves
- Location cell hint reveals all 3 location attributes (continent, subregion, hemisphere) for a single credit/cost
- Once revealed: cell shows an inverted target value badge (bg-charcoal text-paper-white, Check icon)
- Hint state managed by `GameGrid.tsx` (pendingMajorHint state, accepts `string | string[]`)

## Design System Rules
- **"Thermal E-Paper / Scientific Journal"** aesthetic — *The New York Times* data journalism meets a high-end e-reader
- Background: `#FAFAF9` (paper-white), Foreground: `#18181B` (charcoal/jet black), Structural borders: `#E2E8F0` (graphite)
- **Sharp corners** (`--radius: 0px`), thin borders (`border` / 1px)
- **Typography**: Fraunces Variable serif (`font-serif-display`) for headings/titles, Geist Mono for data/clues/body
- **Logo**: Venn diagram SVG (teal + pink overlapping circles with golden intersection), title "SCALAR" in Fraunces serif font-light
- **Thermal feedback colors**: EXACT = green (#22C55E), HOT = orange (#F97316), NEAR = muted amber with dashed border, MISS = white bg
- **GEO_DISTANCE gradient**: green (<1000km including 0km) -> amber (<3000km) -> yellow (<5000km) -> white (>=5000km)
- **DISTANCE_GRADIENT (location text)**: green if exact match, white if miss (binary)
- Category match: green (exact), gold (category match), white (miss)
- Direction indicators: shown as text arrows (↑/↓) in secondary text, not thick borders
- Hidden cells: 45deg diagonal striped pattern via `bg-hidden-pattern` utility
- Folded cells: no longer locked — rendered as normal feedback cells in expandable section
- **Shadows**: Hard-edge "paper cut" shadows (`shadow-hard`, `shadow-hard-sm`) — no soft blurs
- **Buttons**: Invert on hover (outline -> filled, filled -> outline)
- **Input**: Underline-style (bottom border only, no box)
- When adding Shadcn/UI components: remove rounding, use thin borders, use `border-graphite` for structural borders

## CSS Custom Utilities (index.css)
```
bg-hidden-pattern    — 45deg diagonal stripes on #F8FAFC background
bg-folded-pattern    — -45deg diagonal stripes on #F1F5F9 background (darker)
bg-geo-hot           — #F97316 (Solar Orange), white text
bg-geo-warm          — #F59E0B (Amber), charcoal text
bg-geo-cool          — #14B8A6 (Glacial Teal), white text
bg-geo-yellow        — #FACC15 (Yellow), charcoal text — distance cell <5000km tier
bg-geo-cold          — #E2E8F0 (Graphite gray), charcoal text
bg-cat-match         — #EAB308 (Success Gold), charcoal text
bg-cat-miss          — #E2E8F0 (Graphite gray), charcoal text
font-serif-display   — Fraunces Variable serif font family
shadow-hard          — 6px 6px hard-edge shadow (modals)
shadow-hard-sm       — 4px 4px hard-edge shadow (popups)
border-venn-active   — teal -> gold -> pink gradient border image
border-b-venn        — subtle gradient underline (header separator)
```

## Tailwind Color Tokens (defined in `@theme inline`)
```
paper-white      — #FAFAF9 (canvas background)
charcoal         — #18181B (primary text/ink)
graphite         — #E2E8F0 (structural borders)
thermal-gold     — #EAB308 (category match / linked bucket match)
thermal-orange   — #F97316 (hot / close)
thermal-teal     — #14B8A6 (cool / far)
thermal-amber    — #F59E0B (warm / medium)
thermal-green    — #22C55E (exact match / win)
venn-teal        — #14B8A6 (logo/background teal circle)
venn-pink        — #F472B6 (logo/background pink circle)
venn-gold        — #EAB308 (logo/background intersection)
```

## TypeScript Conventions
- Use `import type` for type-only imports (enforced by `verbatimModuleSyntax`)
- Path alias: `@/` maps to `src/` (configured in vite.config.ts and tsconfig.app.json)
- Target: ES2022, strict mode enabled
- All React components are functional with typed props
- `gameData.json` is cast via `as unknown as GameData` for dynamic access
- Schema is an ordered array (`CategorySchema = SchemaField[]`), preserving CSV column order

## Data Pipeline

### Source Format
Game data is defined in CSV files in the `data/` directory:
- **Schema configs**: `{category}_schema_config.csv` — define field types, logic types, display formats, folded status, etc.
- **Enriched data**: `{category}_enriched.csv` — entity rows with all attribute values

### Data Enrichment & Cleaning Scripts
The `data/` directory also contains Python scripts for preparing raw data:
- `enrich_countries.py` / `categorize_countries.py` — enrich and categorize country data
- `enrich_hollywood.py` (also at root) — enrich Hollywood movie data with additional attributes
- `clean_animals.py` — clean and normalize animal data
- `clean_chemicals.py` — clean and normalize chemical element data

### Fetch Script (`fetch_data.py`)
```bash
python fetch_data.py
```
- Reads schema config CSVs and enriched data CSVs from `data/`
- Parses data types (INT, FLOAT, STRING, CURRENCY, BOOLEAN, LIST)
- Cleans values (strips `$`, commas; handles null/-1 as missing)
- Outputs `src/assets/data/gameData.json` with structure:
  ```json
  {
    "schemaConfig": { "category": [SchemaField, ...] },
    "categories": { "category": [Entity, ...] }
  }
  ```

### Adding a New Category
1. Create `data/{category}_schema_config.csv` with column definitions
2. Create `data/{category}_enriched.csv` with entity data
3. Add entry to `CATEGORY_MAP` in `fetch_data.py`
4. Run `python fetch_data.py`
5. UI auto-discovers the new category — no component code changes needed

## Category Schemas

### Countries
| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Continent | CATEGORY_MATCH | TEXT | Distance gradient coloring |
| Subregion | CATEGORY_MATCH | TEXT | Distance gradient coloring |
| Hemisphere | CATEGORY_MATCH | TEXT | Distance gradient coloring |
| Distance | GEO_DISTANCE | DISTANCE | Virtual field, haversine km |
| Area (sq km) | HIGHER_LOWER | PERCENTAGE_DIFF | Linked to area_cat |
| Population | HIGHER_LOWER | PERCENTAGE_DIFF | Linked to population_cat |
| Landlocked? | EXACT_MATCH | TEXT | |
| Timezones | HIGHER_LOWER | NUMBER | Linked to timezone_cat |
| GDP / Capita | HIGHER_LOWER | PERCENTAGE_DIFF | **Folded**, linked to gdp_per_capita_cat |
| Armed Forces | HIGHER_LOWER | PERCENTAGE_DIFF | **Folded**, linked to armed_forces_cat |
| Pop. Density | HIGHER_LOWER | NUMBER | **Folded**, linked to pop_density_cat |
| Olympics Hosted | HIGHER_LOWER | NUMBER | **Folded** |
| Last Olympics | HIGHER_LOWER | NUMBER | **Folded** |

### Hollywood
| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Release Year | HIGHER_LOWER | NUMBER | Linked to Year_category |
| Genre | SET_INTERSECTION | LIST | Full-width row, per-item match coloring |
| Cast & Crew | SET_INTERSECTION | LIST | Full-width row, per-item match coloring |
| MPAA Rating | CATEGORY_MATCH | TEXT | |
| Source Material | CATEGORY_MATCH | TEXT | |
| Box Office | HIGHER_LOWER | CURRENCY | Linked to box_office_category |
| Runtime (mins) | HIGHER_LOWER | NUMBER | **Folded**, linked to duration_mins_category |
| Production Co. | CATEGORY_MATCH | TEXT | **Folded** |
| IMDb Rating | HIGHER_LOWER | NUMBER | **Folded**, linked to imdbRating_category |
| Oscars Won | HIGHER_LOWER | NUMBER | **Folded** |

### Chemicals
| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Atomic # | HIGHER_LOWER | NUMBER | |
| Group | HIGHER_LOWER | NUMBER | Linked to GroupBlock |
| Phase (STP) | CATEGORY_MATCH | TEXT | |
| Radioactive | EXACT_MATCH | TEXT | |
| Period | HIGHER_LOWER | NUMBER | |
| Rarity | CATEGORY_MATCH | TEXT | **Folded** |
| Discovered | HIGHER_LOWER | NUMBER | **Folded**, linked to year_discovered_range |
| Atomic Mass | HIGHER_LOWER | NUMBER | **Folded**, linked to atomic_mass_range |
| Density | HIGHER_LOWER | NUMBER | **Folded**, linked to density_range |
| Melt Point (K) | HIGHER_LOWER | NUMBER | **Folded**, linked to melting_point_range |
| Boil Point (K) | HIGHER_LOWER | NUMBER | **Folded**, linked to boiling_point_range |
| Synthetic | EXACT_MATCH | TEXT | **Folded** |
| Neutrons | HIGHER_LOWER | NUMBER | **Folded** |
| Electronegativity | HIGHER_LOWER | NUMBER | **Folded** |
| Atomic Radius | HIGHER_LOWER | NUMBER | **Folded** |
| Ionization | HIGHER_LOWER | NUMBER | **Folded** |
| Conductivity | CATEGORY_MATCH | TEXT | **Folded** |

### Animals
| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Class | EXACT_MATCH | TEXT | |
| Skin Type | EXACT_MATCH | TEXT | |
| Diet | EXACT_MATCH | TEXT | |
| Weight | HIGHER_LOWER | RELATIVE_PERCENTAGE | Linked to weight_class |
| Height (cm) | HIGHER_LOWER | RELATIVE_PERCENTAGE | Linked to height_class |
| Top Speed | HIGHER_LOWER | NUMBER | Linked to speed_class |
| Activity | EXACT_MATCH | TEXT | |
| Lifespan | HIGHER_LOWER | NUMBER | **Folded**, linked to lifespan_class |
| Daily Sleep | HIGHER_LOWER | NUMBER | **Folded**, linked to sleep_class |
| Gestation | HIGHER_LOWER | NUMBER | **Folded** |
| Status | EXACT_MATCH | TEXT | **Folded** (conservation status) |

## Related Documentation
- **GAMEPLAY.md** — Detailed gameplay logic, scoring system, feedback types, color system, hint mechanics, and example turns
- **STYLE_GUIDE.md** — Comprehensive visual design system: color palette, typography, spacing, component visual designs (with ASCII diagrams), animations, responsive breakpoints, and key design rules

## Important Gotchas
- `credentials.json` is gitignored - needed only for legacy Google Sheets access
- No test framework is configured - `gameLogic.ts` pure functions are the best candidates for unit tests
- localStorage keys: `scalar-game-storage` (game state), `scalar-htp-seen` (how-to-play modal shown)
- Store version is 12 - bumping it triggers migration (clears stale localStorage)
- No difficulty modes exist - the game is a single difficulty with Total Moves scoring
- Game status flow: PLAYING -> SOLVED (win) or PLAYING -> REVEALED (forfeit)
- `linkedCategoryCol` fields are hidden support columns (logicType: NONE, displayFormat: HIDDEN) used for HIGHER_LOWER status coloring — HOT when category matches, MISS otherwise
- Virtual fields (`isVirtual: true`) like `distance_km` are computed at feedback time, not stored in entity data

## Game Concepts Reference
- **Categories**: countries, hollywood, chemicals, animals (driven by `gameData.json` schema)
- **Logic types**: EXACT_MATCH, CATEGORY_MATCH, HIGHER_LOWER, GEO_DISTANCE, SET_INTERSECTION, TARGET, NONE
- **Feedback statuses**: EXACT (exact match), HOT (close/category match), NEAR (nearby), MISS (no match)
- **Feedback directions**: UP (target higher), DOWN (target lower), EQUAL, NONE (non-numeric)
- **Column visibility**: All non-folded columns visible by default.
- **Folded attributes**: Extra clues in a collapsible "More clues" section on each card. Uses credit system to reveal.
- **Free hint credits**: 3 per game. Consumed by column/folded reveals and eye-icon hints. Displayed as filled squares in Scoreboard.
- **Hints (eye icon)**: Reveals exact target value for any attribute. Free with credits, +3 moves without. Available on all cell types.
- **Challenge Mode**: Shareable URLs via `?challenge=` query param. Base64-encoded JSON `{c: categoryId, i: entityId}`. Decoded on mount in App.tsx, triggers `startChallengeGame`. URL cleaned after load.
- **Win condition**: All feedback fields are EXACT
- **Forfeit**: Reveal Answer shows target + all attributes. Status becomes REVEALED. Moves set to total entity count in category.
- **Analytics**: Vercel Analytics tracks page views and game completion events (category, moves, hints used). No cookies, daily-reset hash, privacy-respecting.
- **Privacy Policy**: Accessible via footer link. Explains local storage usage, Vercel Analytics data collection, and what is NOT collected.
- **Share Challenge**: Fixed bottom-right button generates challenge URLs via Base64-encoded category+entity. Uses Web Share API or clipboard.

## Common Task Patterns

### Adding a new game mechanic
1. Add pure function to `src/utils/gameLogic.ts`
2. Add state/action to `src/store/gameStore.ts` that calls the pure function
3. Consume new state in the relevant component

### Adding a new category
1. Create `data/{category}_schema_config.csv` with field definitions
2. Create `data/{category}_enriched.csv` with entity data
3. Add entry to `CATEGORY_MAP` in `fetch_data.py`
4. Run `python fetch_data.py` to regenerate `gameData.json`
5. UI auto-discovers - no code changes needed

### Adding a new logic type
1. Add the logic type to `LogicType` union in `src/types.ts`
2. Create a handler function in `src/utils/gameLogic.ts`
3. Add the case to the switch in `getFeedback()`
4. Update `src/utils/feedbackColors.ts` if new coloring logic is needed
5. Update `GuessCard.tsx` if new cell rendering is needed
6. Add custom CSS utilities to `src/index.css` if needed

### Adding a new UI component
1. Use Shadcn CLI or create manually in `src/components/`
2. Match editorial theme: sharp corners, `border border-graphite` for structural borders, `border border-charcoal` for interactive elements
3. Use `font-serif-display` for display headings, Geist Mono (default) for data
4. Use `shadow-hard` or `shadow-hard-sm` for elevated elements (no soft shadows)
5. Use `cn()` from `@/utils/cn` for conditional class merging

### Modifying theme
1. Edit CSS custom properties in `src/index.css` `:root` block
2. Colors use HSL format without `hsl()` wrapper (Tailwind v4 convention)
3. Custom utility colors defined via `@utility` blocks

### Modifying scoring
1. Move costs are defined as constants in `gameStore.ts` (`HINT_MOVE_COST = 3`)
2. Free credits default is `DEFAULT_CREDITS = 3` in `gameStore.ts`
3. Each guess adds +1 move in `submitGuess` action
