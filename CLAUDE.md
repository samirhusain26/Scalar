# Scalar - Project Context

> **Maintenance rule**: When making significant changes (new files, new dependencies, architecture changes, new features), update this file to reflect those changes before committing.

## What Is This Project?
Scalar is a client-side deductive logic guessing game (similar to Wordle but with numerical attributes). Players guess entities (countries, movies, chemical elements, animals) and receive feedback via multiple logic systems — directional arrows, proximity tiers, geographic distance, category matching, and set intersection — to deduce the target. Features a golf-style scoring system where players try to minimize their stroke count.

## Repository Layout
```
Scalar/                              # Git root
├── CLAUDE.md                        # THIS FILE - project context
├── README.md                        # Project documentation
├── .gitignore
├── credentials.json                 # Google Service Account (DO NOT COMMIT - gitignored)
├── fetch_data.py                    # Python script: CSV files -> gameData.json
├── package.json                     # npm package (scalar, private)
├── package-lock.json
├── vite.config.ts                   # Vite build config (@ alias -> src/)
├── tsconfig.json                    # TypeScript root config (references app/node)
├── tsconfig.app.json                # App TS config (ES2022, strict)
├── tsconfig.node.json               # Node TS config (ES2023)
├── eslint.config.js                 # ESLint flat config (v9)
├── postcss.config.js                # PostCSS: @tailwindcss/postcss + autoprefixer
├── components.json                  # Shadcn CLI config
├── index.html                       # HTML entry point
├── data/                            # Source data files for game content
│   ├── countries_schema_config.csv  # Countries schema definition
│   ├── countries_enriched.csv       # Countries entity data
│   ├── hollywood_schema_config.csv  # Hollywood schema definition
│   ├── hollywood_enriched.csv       # Hollywood entity data
│   ├── chemicals_schema_config.csv  # Chemicals schema definition
│   ├── chemicals_enriched.csv       # Chemicals entity data (not tracked)
│   ├── animals_schema_config.csv    # Animals schema definition
│   └── animals_enriched.csv         # Animals entity data
└── src/                             # React/TypeScript source
    ├── main.tsx                     # Entry point: StrictMode, imports Geist Mono font + index.css
    ├── App.tsx                      # Root component: header, category selector, scoreboard, grid, input, modals
    ├── App.css                      # Unused Vite boilerplate (safe to delete)
    ├── index.css                    # Tailwind v4 config + CSS custom properties + custom utilities
    ├── types.ts                     # All shared types: DataType, LogicType, DisplayFormat, UIColorLogic, SchemaField, Entity, Feedback, Rank, etc.
    ├── assets/
    │   └── data/gameData.json       # Static game data: schema definitions + entity data per category (auto-generated by fetch_data.py)
    ├── store/
    │   └── gameStore.ts             # Zustand store: single source of truth, localStorage persistence (version 4)
    ├── utils/
    │   ├── gameLogic.ts             # Pure functions: getFeedback (dispatch by logicType), checkWinCondition, calculateRank, etc.
    │   ├── formatters.ts            # formatNumber(), formatDistance(), formatPercentageDiffTier(), getDirectionSymbol()
    │   ├── geo.ts                   # haversineDistance(): great-circle distance between coordinates
    │   ├── schemaParser.ts          # getDisplayColumns(), getFoldedColumns(), getVisibleCandidateColumns(), getFieldByKey()
    │   └── cn.ts                    # cn(): clsx + tailwind-merge utility
    ├── lib/
    │   └── utils.ts                 # Duplicate of cn.ts (from Shadcn init)
    └── components/
        ├── ui/                      # Shadcn/UI primitives (button, card, dialog, input)
        ├── GameGrid.tsx             # Main grid: dynamic columns from schema, column visibility, folded state, rows
        ├── GameInput.tsx            # Autocomplete input: tag cloud suggestions opening upward, keyboard nav
        ├── GameOverModal.tsx        # Radix Dialog: bottom-sheet on mobile, centered on desktop. Share + Play Again
        ├── GridHeader.tsx           # Column headers: hidden (+) / folded (lock) / visible (label + eye) / major-hinted (value + check)
        ├── GridRow.tsx              # Single guess row: name column + data columns, display format rendering
        ├── GridCell.tsx             # Individual cell: status colors, directional borders, distance gradient, category match, hidden/folded patterns
        ├── FoldedHintModal.tsx      # Radix Dialog: confirmation for folded attribute reveal (+2 strokes penalty)
        ├── HowToPlayModal.tsx       # Radix Dialog: gameplay instructions, auto-opens on first visit (localStorage: scalar-htp-seen)
        ├── MajorHintModal.tsx       # Radix Dialog: confirmation for major hint (+5 strokes penalty)
        ├── RevealAnswerModal.tsx    # Radix Dialog: shows target entity + all attribute values on forfeit
        └── Scoreboard.tsx           # Header display: strokes, par offset (E/+X/-X), rank badge
```

## Tech Stack
- **React 19** with **TypeScript ~5.9** (strict mode, `noUnusedLocals`, `noUnusedParameters`)
- **Vite 7** for build/dev (`npm run dev` / `npm run build`)
- **Tailwind CSS v4** (uses `@theme inline` syntax in CSS, NOT `tailwind.config.js`)
- **Zustand 5** for state management with localStorage persistence
- **Shadcn/UI** (Radix UI primitives) for base components
- **Lucide React** for icons (Plus, Eye, Check, Lock, Trophy, Medal, Award, etc.)
- **Geist Mono** font everywhere (monospace aesthetic)

## Key Commands
All commands run from repo root:
```bash
npm run dev       # Vite dev server at http://localhost:5173
npm run build     # tsc -b && vite build -> dist/
npm run lint      # ESLint (flat config, v9)
npm run preview   # Preview production build
```

Data fetch (reads CSVs from `data/`, writes `gameData.json`):
```bash
python fetch_data.py
```

## Architecture Pattern (Strict Separation of Concerns)
1. **Types** (`src/types.ts`) - All shared interfaces/types
2. **Pure Logic** (`src/utils/gameLogic.ts`) - Game mechanics as pure functions, NO state mutation
3. **State** (`src/store/gameStore.ts`) - Zustand store calls pure functions, updates state
4. **Components** (`src/components/`) - Consume state via `useGameStore`, render UI

**Data flow**: User action -> Component dispatches store action -> Store calls pure function from gameLogic -> Store updates state -> Components re-render -> localStorage persisted automatically

## Type System (`types.ts`)

### LogicType (how feedback is computed per field)
| LogicType | Purpose | Example Fields |
|-----------|---------|----------------|
| `EXACT_MATCH` | Binary exact equality | Driving Side, Landlocked?, Radioactive |
| `CATEGORY_MATCH` | String match, optionally colored by distance gradient | Continent, Subregion, Hemisphere, Production Co. |
| `HIGHER_LOWER` | Numeric comparison with direction + percentage diff | Population, Area, GDP, Atomic #, Year |
| `GEO_DISTANCE` | Haversine distance between coordinates | Distance (virtual field in Countries) |
| `SET_INTERSECTION` | Intersection of comma-separated lists | Genre, Cast & Crew |
| `TARGET` | Entity name (identification only) | Country Name, Movie Title |
| `NONE` | Support/hidden column (not displayed) | Latitude, Longitude, category columns |

### DisplayFormat (how cell values render)
| Format | Rendering |
|--------|-----------|
| `HIDDEN` | Column not displayed in grid |
| `TEXT` | Raw string value |
| `DISTANCE` | Formatted km distance (e.g., "1,234 km") |
| `PERCENTAGE_DIFF` | Direction arrow + tier (e.g., "↑ ~25%") |
| `RELATIVE_PERCENTAGE` | Direction arrow + relative % (e.g., "↑ +34%") |
| `NUMBER` | Raw numeric value |
| `CURRENCY` | Direction arrow + $-prefixed value |
| `LIST` | Intersection count "X/Y" |

### UIColorLogic (how cell background is determined)
| Logic | Coloring |
|-------|----------|
| `DISTANCE_GRADIENT` | Color based on haversine distance: green (0km), red (<1000km), yellow (<3000km), blue (<5000km), gray (>=5000km) |
| `CATEGORY_MATCH` | Green if linked category matches, gray if miss |
| `STANDARD` | Traditional EXACT/HOT/NEAR/MISS colors |
| `NONE` | No special coloring |

### SchemaField Interface
```typescript
interface SchemaField {
    attributeKey: string;         // Column key in entity data
    displayLabel: string;         // Human-readable header label
    dataType: DataType;           // INT, FLOAT, STRING, CURRENCY, BOOLEAN, LIST
    logicType: LogicType;         // How feedback is computed
    displayFormat: DisplayFormat; // How the cell renders
    isFolded: boolean;            // Starts locked, costs +2 to reveal
    isVirtual: boolean;           // Computed field (e.g., distance_km)
    linkedCategoryCol?: string;   // Category column for HIGHER_LOWER status coloring
    uiColorLogic?: UIColorLogic;  // Override cell color logic
}
```

### Feedback Interface
```typescript
interface Feedback {
    direction: FeedbackDirection;     // UP, DOWN, EQUAL, NONE
    status: FeedbackStatus;           // EXACT, HOT, NEAR, MISS
    value: string | number | boolean; // Raw guess value
    displayValue?: string;            // Formatted display string
    distanceKm?: number;              // For GEO_DISTANCE / DISTANCE_GRADIENT
    percentageDiff?: number;          // For HIGHER_LOWER
    categoryMatch?: boolean;          // For linked category coloring
}
```

## Component Details

### App.tsx
- Derives `CATEGORIES` from `gameData.categories` keys
- Renders category tabs, header bar (category name, masked answer, Scoreboard)
- Subtitle: "Daily Logic"
- "How to Play" link opens HowToPlayModal (auto-opens on first visit via localStorage `scalar-htp-seen`)
- Win effect: briefly adds `invert` class to `<html>` on SOLVED status
- Answer display: shows `??????` while PLAYING, reveals name (truncated to 12 chars) when solved/revealed
- "Reveal Answer" button during PLAYING triggers `revealAnswer()` -> REVEALED state
- RevealAnswerModal receives active category schema for attribute display

### GameGrid.tsx
- Uses `getDisplayColumns()` from schemaParser to get visible fields
- Dynamic row count: `max(guesses.length + 1, 6)` minimum rows
- Passes `revealedFoldedAttributes` to GridHeader and GridRow
- Displays ALL display columns (visible + hidden + folded)

### GridHeader.tsx
- Four column header states:
  - **Hidden** (non-folded, not visible): Narrow (w-8), Plus icon, click to reveal (+1 stroke)
  - **Folded** (not yet revealed): Full width, Lock icon + label, click opens FoldedHintModal (+2 strokes)
  - **Visible**: Full width, label text + Eye icon for HIGHER_LOWER fields (triggers MajorHintModal)
  - **Major-hinted**: Inverted colors (bg-charcoal, text-paper-white), shows exact target value + Check icon
- Manages MajorHintModal and FoldedHintModal open/close state internally

### GameInput.tsx
- Autocomplete with upward-opening tag cloud suggestions
- Keyboard navigation: ArrowUp/Down to navigate, Enter to select, Escape to close
- Disabled with "Solved" placeholder when game is SOLVED or REVEALED
- Suggestions limited to 8 items, deduplicated by name
- Shows current stroke count above input

### GameOverModal.tsx
- Radix Dialog with bottom-sheet animation on mobile, centered modal on desktop
- Title: "Puzzle Complete"
- Shows target entity name, score (strokes), par, rank badge
- Share button: builds emoji grid (green/yellow/black squares), uses Web Share API if available, falls back to clipboard
- "Play Again" button to reset

### RevealAnswerModal.tsx
- Radix Dialog: bottom-sheet on mobile, centered on desktop
- Title: "Answer Revealed"
- Uses `getDisplayColumns()` to show all target entity attributes in a scrollable list
- Formats numbers, booleans, and strings per type
- "New Game" button to reset

### GridRow.tsx
- Renders single guess row (name + data columns)
- Handles empty rows (placeholder structure with dashed borders)
- Renders hidden cells narrow, folded cells with folded pattern, visible cells with feedback
- Passes `displayFormat` and `uiColorLogic` from schema to GridCell

### GridCell.tsx
- **Hidden state**: `bg-hidden-pattern` (45deg diagonal striped pattern)
- **Folded state**: `bg-folded-pattern` (-45deg diagonal striped pattern, darker)
- **Empty state**: `border-dashed border-charcoal`
- **Color logic dispatch**:
  - `DISTANCE_GRADIENT`: green (0km), `bg-geo-hot` (<1000km), `bg-geo-warm` (<3000km), `bg-geo-cool` (<5000km), `bg-geo-cold` (>=5000km)
  - `CATEGORY_MATCH` / `categoryMatch`: `bg-cat-match` (green) or `bg-cat-miss` (gray)
  - Standard: EXACT = `bg-green-600 text-white`, HOT = `bg-yellow-200`, NEAR = `bg-amber-100 border-dashed border-amber-400`, MISS = `bg-gray-200`
- Direction borders: UP = `border-t-[4px] border-t-black`, DOWN = `border-b-[4px] border-b-black`
- Displays `feedback.displayValue` if present, falls back to raw `value`

### FoldedHintModal.tsx
- Radix Dialog with centered modal layout
- Title: "Reveal Clue?"
- Warning: "Revealing the [attribute] clue will add +2 strokes to your score."
- Buttons: Cancel, Reveal (+2)

### HowToPlayModal.tsx
- Auto-opens on first visit (localStorage key: `scalar-htp-seen`)
- Sections: Goal, How It Works, Feedback Colors (with swatches), Direction Indicators, Scoring, Ranks, Hints
- Responsive: bottom-sheet on mobile, centered modal on desktop

### MajorHintModal.tsx
- Simple confirmation dialog for major hint reveal
- Warns about +5 stroke penalty
- Buttons: Cancel, Reveal (+5)

### Scoreboard.tsx
- Right side of header bar
- Displays: Strokes count, par offset (E/+X/-X), Par value, Rank icon + label
- Rank icons: Trophy (GOLD), Medal (SILVER), Award (BRONZE)
- Rank label hidden on mobile (sm:inline)

## Store (gameStore.ts)
```
State:
  activeCategory: string                  (default: 'countries')
  targetEntity: Entity                    (random on init/reset)
  guesses: GuessResult[]
  gameStatus: 'PLAYING' | 'SOLVED' | 'REVEALED'
  score: number                           (golf-style stroke count, lower is better)
  par: number                             (default: 4)
  columnVisibility: Record<string, boolean>  (2 random non-folded columns visible initially)
  majorHintAttributes: string[]           (tracks which attrs have been major-hinted)
  revealedFoldedAttributes: string[]      (tracks which folded attrs have been revealed)

Actions:
  setActiveCategory(cat) -> full reset with new target, new column visibility
  submitGuess(entity) -> computes feedback, increments score +1, checks win
  revealColumn(attr) -> makes hidden column visible, +1 stroke penalty
  revealMajorHint(attr) -> reveals exact target value in header, +5 stroke penalty
  revealFoldedAttribute(attr) -> unlocks folded attribute, +2 stroke penalty
  revealAnswer() -> forfeit: set status to REVEALED (no score awarded)
  resetGame() -> new target, clear guesses, keep category
```

Persisted to localStorage under key `scalar-game-storage` (version 4 with migration).

## Game Logic (gameLogic.ts) — Feedback Engine

The feedback system uses a **dispatch pattern** based on each field's `logicType`:

```
getFeedback(target, guess, schema)
  ├── Pre-computes haversine distance (for DISTANCE_GRADIENT fields)
  └── For each schema field:
      ├── EXACT_MATCH   → handleExactMatch()
      ├── CATEGORY_MATCH → handleCategoryMatch()
      ├── HIGHER_LOWER  → handleHigherLower()
      ├── GEO_DISTANCE  → handleGeoDistance()
      └── SET_INTERSECTION → handleSetIntersection()
```

### Handler Functions

| Handler | Logic | Status Rules | Display |
|---------|-------|-------------|---------|
| `handleExactMatch` | Binary equality (case-insensitive strings, boolean) | EXACT or MISS | Raw value (booleans show "Yes"/"No") |
| `handleCategoryMatch` | String equality; attaches `distanceKm` when `uiColorLogic === 'DISTANCE_GRADIENT'` | EXACT or MISS | Raw value |
| `handleHigherLower` | Numeric comparison; computes `percentageDiff`; checks `linkedCategoryCol` for status | EXACT if equal; HOT if linked category matches; MISS otherwise | Arrow + tier/percentage/currency per displayFormat |
| `handleGeoDistance` | Uses pre-computed haversine distance | EXACT (0km), HOT (<1000km), NEAR (<3000km), MISS (>=3000km) | Formatted distance string |
| `handleSetIntersection` | Comma-separated list intersection-over-union ratio | EXACT (ratio=1), HOT (>0.5), NEAR (>0), MISS (0) | "X/Y" intersection count |

### Utility Functions

| Function | Purpose |
|----------|---------|
| `getRandomTarget(gameData, category)` | Random entity from category |
| `checkWinCondition(feedback)` | Returns true if ALL statuses are EXACT |
| `getSuggestions(entities, query, guessedIds)` | Fuzzy match for autocomplete (max 8) |
| `calculateRank(score, par)` | Returns RankInfo: GOLD (<=par), SILVER (<=par+3), BRONZE (>par+3) |
| `getInitialColumnVisibility(schema)` | Randomly picks 2 non-folded display columns to start visible |

### Supporting Utilities

**formatters.ts:**
| Function | Purpose |
|----------|---------|
| `formatNumber(num, digits)` | Converts to k/M/B/T/P/E suffixed strings |
| `formatDistance(km)` | Formats distance (e.g., "1,234 km", "1.5M km") |
| `formatPercentageDiffTier(percentDiff)` | Buckets into tiers: "Exact", "~10%", "~25%", "~50%", "~100%", "200%+" |
| `getDirectionSymbol(direction)` | Returns "↑" for UP, "↓" for DOWN, "" otherwise |

**geo.ts:**
| Function | Purpose |
|----------|---------|
| `haversineDistance(lat1, lon1, lat2, lon2)` | Great-circle distance in km using Haversine formula |

**schemaParser.ts:**
| Function | Purpose |
|----------|---------|
| `getDisplayColumns(schema)` | Fields where `displayFormat !== 'HIDDEN'` |
| `getFoldedColumns(schema)` | Fields where `isFolded === true` |
| `getVisibleCandidateColumns(schema)` | Display fields that are NOT folded (for initial visibility randomization) |
| `getFieldByKey(schema, key)` | Lookup by `attributeKey` |

## Scoring System (Golf-Style)
- **+1 stroke** per guess submitted
- **+1 stroke** per hidden column revealed
- **+2 strokes** per folded attribute revealed
- **+5 strokes** per major hint (exact value reveal)
- **Par**: 4 (default)
- **Ranks**:
  - GOLD "Editorial Choice" (score <= par)
  - SILVER "Subscriber" (score <= par + 3)
  - BRONZE "Casual Reader" (score > par + 3)
- **Forfeit**: Reveal Answer ends game as REVEALED (no rank awarded)

## Column Visibility & Hint Systems
- On game start, 2 random **non-folded** display columns are visible; the rest are hidden
- Hidden columns appear as narrow collapsed headers with a `+` icon
- Hidden cells display a 45deg diagonal hatched pattern (`bg-hidden-pattern`)
- Revealing a hidden column costs +1 stroke

### Folded Attributes
- Schema fields marked `isFolded: true` start locked with a separate visual treatment
- Folded headers show full width with a **Lock** icon + label name
- Folded cells display a -45deg diagonal pattern (`bg-folded-pattern`, darker than hidden)
- Revealing a folded attribute costs +2 strokes (confirmation via FoldedHintModal)
- Folded columns are NOT included in the initial visibility randomization

### Major Hints
- Eye icon on HIGHER_LOWER visible column headers
- Reveals the exact target value in the column header for +5 strokes
- Confirmation via MajorHintModal
- Revealed headers show inverted styling with Check icon

## Design System Rules
- **Minimalist Digital Paper / Editorial** aesthetic - high contrast, monochrome-leaning, clean and minimalist
- Background: `#F9F9F7` (paper-white), Foreground/Borders: `#1A1A1A` (charcoal)
- **Sharp corners** (`--radius: 0px`), thin borders (`border` / 1px)
- **Geist Mono** for ALL text
- Feedback colors (standard): EXACT = green, HOT = yellow, NEAR = muted amber with dashed border, MISS = gray
- Distance gradient: green (0km) -> red (<1000km) -> yellow (<3000km) -> blue (<5000km) -> gray (>=5000km)
- Category match: green (match), gray (miss)
- Direction indicators: UP = top border (4px), DOWN = bottom border (4px)
- Hidden cells: 45deg diagonal striped pattern via `bg-hidden-pattern` utility
- Folded cells: -45deg diagonal striped pattern via `bg-folded-pattern` utility
- When adding Shadcn/UI components: remove rounding, use thin borders to match theme

## CSS Custom Utilities (index.css)
```
bg-hidden-pattern  — 45deg diagonal stripes on #F5F5F3 background
bg-folded-pattern  — -45deg diagonal stripes on #EDEDED background (darker)
bg-geo-hot         — #FF6B6B (red), white text
bg-geo-warm        — #FFD93D (yellow), charcoal text
bg-geo-cool        — #B8D4E3 (blue), charcoal text
bg-geo-cold        — #E5E7EB (gray), charcoal text
bg-cat-match       — #16a34a (green), white text
bg-cat-miss        — #E5E7EB (gray), charcoal text
```

## TypeScript Conventions
- Use `import type` for type-only imports (enforced by `verbatimModuleSyntax`)
- Path alias: `@/` maps to `src/` (configured in vite.config.ts and tsconfig.app.json)
- Target: ES2022, strict mode enabled
- All React components are functional with typed props
- `gameData.json` is cast via `as unknown as GameData` for dynamic access
- Schema is an ordered array (`CategorySchema = SchemaField[]`), preserving CSV column order

## Data Pipeline

### Source Format
Game data is defined in CSV files in the `data/` directory:
- **Schema configs**: `{category}_schema_config.csv` — define field types, logic types, display formats, folded status, etc.
- **Enriched data**: `{category}_enriched.csv` — entity rows with all attribute values

### Fetch Script (`fetch_data.py`)
```bash
python fetch_data.py
```
- Reads schema config CSVs and enriched data CSVs from `data/`
- Parses data types (INT, FLOAT, STRING, CURRENCY, BOOLEAN, LIST)
- Cleans values (strips `$`, commas; handles null/-1 as missing)
- Outputs `src/assets/data/gameData.json` with structure:
  ```json
  {
    "schemaConfig": { "category": [SchemaField, ...] },
    "categories": { "category": [Entity, ...] }
  }
  ```

### Adding a New Category
1. Create `data/{category}_schema_config.csv` with column definitions
2. Create `data/{category}_enriched.csv` with entity data
3. Add entry to `CATEGORY_MAP` in `fetch_data.py`
4. Run `python fetch_data.py`
5. UI auto-discovers the new category — no component code changes needed

## Category Schemas

### Countries
| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Continent | CATEGORY_MATCH | TEXT | Distance gradient coloring |
| Subregion | CATEGORY_MATCH | TEXT | Distance gradient coloring |
| Hemisphere | CATEGORY_MATCH | TEXT | Distance gradient coloring |
| Distance | GEO_DISTANCE | DISTANCE | Virtual field, haversine km |
| Area (sq km) | HIGHER_LOWER | PERCENTAGE_DIFF | Linked to area_cat |
| Population | HIGHER_LOWER | PERCENTAGE_DIFF | Linked to population_cat |
| GDP / Capita | HIGHER_LOWER | PERCENTAGE_DIFF | Linked to gdp_per_capita_cat |
| Armed Forces | HIGHER_LOWER | PERCENTAGE_DIFF | Linked to armed_forces_cat |
| Landlocked? | EXACT_MATCH | TEXT | **Folded** (+2 to reveal) |
| Timezones | HIGHER_LOWER | NUMBER | **Folded**, linked to timezone_cat |
| Pop. Density | HIGHER_LOWER | NUMBER | **Folded**, linked to pop_density_cat |
| Olympics Hosted | HIGHER_LOWER | NUMBER | **Folded** |
| Last Olympics | HIGHER_LOWER | NUMBER | **Folded** |

### Hollywood
| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Release Year | HIGHER_LOWER | NUMBER | Linked to Year_category |
| Genre | SET_INTERSECTION | LIST | Comma-separated |
| Cast & Crew | SET_INTERSECTION | LIST | Comma-separated |
| Runtime (mins) | HIGHER_LOWER | NUMBER | Linked to duration_mins_category |
| Production Co. | CATEGORY_MATCH | TEXT | |
| Box Office | HIGHER_LOWER | CURRENCY | Linked to box_office_category |
| IMDb Rating | HIGHER_LOWER | NUMBER | **Folded**, linked to imdbRating_category |
| MPAA Rating | CATEGORY_MATCH | TEXT | **Folded** |
| Oscars Won | HIGHER_LOWER | NUMBER | **Folded** |
| Source Material | CATEGORY_MATCH | TEXT | **Folded** |

### Chemicals
| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Atomic # | HIGHER_LOWER | NUMBER | |
| Group | HIGHER_LOWER | NUMBER | Linked to GroupBlock |
| Phase (STP) | CATEGORY_MATCH | TEXT | |
| Rarity | CATEGORY_MATCH | TEXT | |
| Discovered | HIGHER_LOWER | NUMBER | Linked to year_discovered_range |
| Atomic Mass | HIGHER_LOWER | NUMBER | **Folded**, linked to atomic_mass_range |
| Density | HIGHER_LOWER | NUMBER | **Folded**, linked to density_range |
| Melt Point (K) | HIGHER_LOWER | NUMBER | **Folded**, linked to melting_point_range |
| Boil Point (K) | HIGHER_LOWER | NUMBER | **Folded**, linked to boiling_point_range |
| Radioactive | EXACT_MATCH | TEXT | **Folded** |
| Synthetic | EXACT_MATCH | TEXT | **Folded** |
| Neutrons | HIGHER_LOWER | NUMBER | **Folded** |
| Electronegativity | HIGHER_LOWER | NUMBER | **Folded** |
| Atomic Radius | HIGHER_LOWER | NUMBER | **Folded** |
| Ionization | HIGHER_LOWER | NUMBER | **Folded** |
| Conductivity | CATEGORY_MATCH | TEXT | **Folded** |
| Period | HIGHER_LOWER | NUMBER | **Folded** |

### Animals
| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Class | EXACT_MATCH | TEXT | |
| Skin Type | EXACT_MATCH | TEXT | |
| Diet | EXACT_MATCH | TEXT | |
| Weight | HIGHER_LOWER | RELATIVE_PERCENTAGE | Linked to weight_class |
| Height (cm) | HIGHER_LOWER | RELATIVE_PERCENTAGE | Linked to height_class |
| Top Speed | HIGHER_LOWER | NUMBER | Linked to speed_class |
| Lifespan | HIGHER_LOWER | NUMBER | Linked to lifespan_class |
| Daily Sleep | HIGHER_LOWER | NUMBER | **Folded**, linked to sleep_class |
| Gestation | HIGHER_LOWER | NUMBER | **Folded** |
| Activity | EXACT_MATCH | TEXT | **Folded** |
| Status | EXACT_MATCH | TEXT | **Folded** (conservation status) |

## Important Gotchas
- `App.css` contains leftover Vite boilerplate styles (unused) - safe to ignore or clean up
- `credentials.json` is gitignored - needed only for legacy Google Sheets access
- No test framework is configured - `gameLogic.ts` pure functions are the best candidates for unit tests
- localStorage keys: `scalar-game-storage` (game state), `scalar-htp-seen` (how-to-play modal shown)
- `lib/utils.ts` is a duplicate of `utils/cn.ts` (from Shadcn init)
- Store version is 4 - bumping it triggers migration (clears stale localStorage)
- No difficulty modes exist - the game is a single difficulty with golf-style scoring
- Game status flow: PLAYING -> SOLVED (win) or PLAYING -> REVEALED (forfeit)
- Hidden columns in `columnVisibility` are for non-folded display columns only
- Folded attributes tracked separately in `revealedFoldedAttributes`
- `linkedCategoryCol` fields are hidden support columns (logicType: NONE, displayFormat: HIDDEN) used for HIGHER_LOWER status coloring — HOT when category matches, MISS otherwise
- Virtual fields (`isVirtual: true`) like `distance_km` are computed at feedback time, not stored in entity data

## Game Concepts Reference
- **Categories**: countries, hollywood, chemicals, animals (driven by `gameData.json` schema)
- **Logic types**: EXACT_MATCH, CATEGORY_MATCH, HIGHER_LOWER, GEO_DISTANCE, SET_INTERSECTION, TARGET, NONE
- **Feedback statuses**: EXACT (exact match), HOT (close/category match), NEAR (nearby), MISS (no match)
- **Feedback directions**: UP (target higher), DOWN (target lower), EQUAL, NONE (non-numeric)
- **Column visibility**: 2 non-folded columns visible at start, others hidden. Reveal costs +1 stroke.
- **Folded attributes**: Locked columns requiring +2 strokes to reveal. Separate from column visibility.
- **Major hint**: Reveals exact target value for a HIGHER_LOWER column header. Costs +5 strokes.
- **Win condition**: All feedback fields are EXACT
- **Forfeit**: Reveal Answer shows target + all attributes. Status becomes REVEALED.
- **Ranks**: GOLD (Editorial Choice), SILVER (Subscriber), BRONZE (Casual Reader) based on score vs par

## Common Task Patterns

### Adding a new game mechanic
1. Add pure function to `src/utils/gameLogic.ts`
2. Add state/action to `src/store/gameStore.ts` that calls the pure function
3. Consume new state in the relevant component

### Adding a new category
1. Create `data/{category}_schema_config.csv` with field definitions
2. Create `data/{category}_enriched.csv` with entity data
3. Add entry to `CATEGORY_MAP` in `fetch_data.py`
4. Run `python fetch_data.py` to regenerate `gameData.json`
5. UI auto-discovers - no code changes needed

### Adding a new logic type
1. Add the logic type to `LogicType` union in `src/types.ts`
2. Create a handler function in `src/utils/gameLogic.ts`
3. Add the case to the switch in `getFeedback()`
4. Update `GridCell.tsx` if new coloring logic is needed
5. Add custom CSS utilities to `src/index.css` if needed

### Adding a new UI component
1. Use Shadcn CLI or create manually in `src/components/`
2. Match editorial theme: sharp corners, `border border-charcoal`, Geist Mono font
3. Use `cn()` from `@/utils/cn` for conditional class merging

### Modifying theme
1. Edit CSS custom properties in `src/index.css` `:root` block
2. Colors use HSL format without `hsl()` wrapper (Tailwind v4 convention)
3. Custom utility colors defined via `@utility` blocks

### Modifying scoring
1. Stroke costs are defined in `gameStore.ts` actions (`submitGuess` +1, `revealColumn` +1, `revealFoldedAttribute` +2, `revealMajorHint` +5)
2. Par is hardcoded to 4 in store initial state and `resetGame`
3. Rank thresholds are in `calculateRank()` in `gameLogic.ts`
