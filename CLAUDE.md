# Scalar - Project Context

> **Maintenance rule**: When making significant changes (new files, new dependencies, architecture changes, new features), update this file to reflect those changes before committing.

## What Is This Project?
Scalar is a client-side deductive logic guessing game (similar to Wordle but with numerical attributes). Players guess entities (countries, chemical elements) and receive feedback via multiple logic systems ‚Äî directional arrows, proximity tiers, geographic distance, category matching, and set intersection ‚Äî to deduce the target. Features a "Total Moves" scoring system where players try to minimize their move count.

## Repository Layout
```
Scalar/                              # Git root
‚îú‚îÄ‚îÄ CLAUDE.md                        # THIS FILE - project context
‚îú‚îÄ‚îÄ README.md                        # Project documentation
‚îú‚îÄ‚îÄ GAMEPLAY.md                      # Detailed gameplay logic & scoring documentation
‚îú‚îÄ‚îÄ STYLE_GUIDE.md                   # Visual design system & component specifications
‚îú‚îÄ‚îÄ .gitignore
‚îú‚îÄ‚îÄ credentials.json                 # Google Service Account (DO NOT COMMIT - gitignored)
‚îú‚îÄ‚îÄ fetch_data.py                    # Python script: CSV files -> gameData.json
‚îú‚îÄ‚îÄ package.json                     # npm package (scalar, private)
‚îú‚îÄ‚îÄ package-lock.json
‚îú‚îÄ‚îÄ vite.config.ts                   # Vite build config (@ alias -> src/)
‚îú‚îÄ‚îÄ tsconfig.json                    # TypeScript root config (references app/node)
‚îú‚îÄ‚îÄ tsconfig.app.json                # App TS config (ES2022, strict)
‚îú‚îÄ‚îÄ tsconfig.node.json               # Node TS config (ES2023)
‚îú‚îÄ‚îÄ eslint.config.js                 # ESLint flat config (v9)
‚îú‚îÄ‚îÄ postcss.config.js                # PostCSS: @tailwindcss/postcss + autoprefixer
‚îú‚îÄ‚îÄ components.json                  # Shadcn CLI config
‚îú‚îÄ‚îÄ index.html                       # HTML entry point
‚îú‚îÄ‚îÄ data/                            # Source data files for game content
‚îÇ   ‚îú‚îÄ‚îÄ countries_schema_config.csv  # Countries schema definition
‚îÇ   ‚îú‚îÄ‚îÄ countries_enriched.csv       # Countries entity data
‚îÇ   ‚îú‚îÄ‚îÄ elements_schema_config.csv   # Elements schema definition
‚îÇ   ‚îú‚îÄ‚îÄ elements_enriched.csv        # Elements entity data
‚îÇ   ‚îî‚îÄ‚îÄ update_countries_csv.py      # One-off data update script for countries
‚îî‚îÄ‚îÄ src/                             # React/TypeScript source
    ‚îú‚îÄ‚îÄ main.tsx                     # Entry point: StrictMode, imports Geist Mono + Fraunces fonts + index.css
    ‚îú‚îÄ‚îÄ App.tsx                      # Root component: header, category selector, scoreboard, grid, input, modals
    ‚îú‚îÄ‚îÄ index.css                    # Tailwind v4 config + CSS custom properties + custom utilities
    ‚îú‚îÄ‚îÄ types.ts                     # All shared types: DataType, LogicType, DisplayFormat, UIColorLogic, SchemaField, Entity, Feedback, etc.
    ‚îú‚îÄ‚îÄ assets/
    ‚îÇ   ‚îî‚îÄ‚îÄ data/gameData.json       # Static game data: schema definitions + entity data per category (auto-generated by fetch_data.py)
    ‚îú‚îÄ‚îÄ store/
    ‚îÇ   ‚îî‚îÄ‚îÄ gameStore.ts             # Zustand store: slot-based architecture, localStorage persistence (version 14)
    ‚îú‚îÄ‚îÄ utils/
    ‚îÇ   ‚îú‚îÄ‚îÄ gameLogic.ts             # Pure functions: getFeedback (dispatch by logicType), checkWinCondition, etc.
    ‚îÇ   ‚îú‚îÄ‚îÄ feedbackColors.ts        # Shared color helpers: getGeoDistanceCellClass, getCategoryMatchClass, getStandardStatusClass, getCellColor
    ‚îÇ   ‚îú‚îÄ‚îÄ formatters.ts            # formatNumber(), formatDistance(), formatPercentageDiffTier(), formatYearDiffTier(), expandConservationStatus(), getDirectionSymbol(), getAlphaDirectionSymbol(), numberToLetter()
    ‚îÇ   ‚îú‚îÄ‚îÄ geo.ts                   # haversineDistance(): great-circle distance between coordinates
    ‚îÇ   ‚îú‚îÄ‚îÄ schemaParser.ts          # getDisplayColumns(), getFoldedColumns(), getVisibleCandidateColumns(), getFieldByKey()
    ‚îÇ   ‚îú‚îÄ‚îÄ challengeUtils.ts        # encodeChallenge(cat, id, moves?), decodeChallenge(): Base64 `{c, i, m?}` JSON challenge URL encoding/decoding
    ‚îÇ   ‚îú‚îÄ‚îÄ analytics.ts             # trackGameEvent(): wrapper for Vercel Analytics event tracking
    ‚îÇ   ‚îú‚îÄ‚îÄ dailyUtils.ts            # getLocalDateString(), formatDateLabel(), formatToggleDateLabel(), getPuzzleNumber(), getDailyEntity() (Mulberry32 PRNG), generateShareText()
    ‚îÇ   ‚îú‚îÄ‚îÄ tutorialConfig.ts        # TUTORIAL_STEPS: TutorialStep[] ‚Äî 6-step config for TutorialOverlay (welcome, controls, legend, hints, answer, done)
    ‚îÇ   ‚îî‚îÄ‚îÄ cn.ts                    # cn(): clsx + tailwind-merge utility
    ‚îî‚îÄ‚îÄ components/
        ‚îú‚îÄ‚îÄ ui/                      # Shadcn/UI primitives (button, card, dialog, input)
        ‚îú‚îÄ‚îÄ CategoryToggle.tsx       # Segmented button group for category selection (replaces <select>)
        ‚îú‚îÄ‚îÄ ModeToggle.tsx           # Segmented button group for daily/freeplay mode selection (same style as CategoryToggle; includes CalendarDays icon + date label)
        ‚îú‚îÄ‚îÄ ColorLegend.tsx          # Persistent color legend strip (Exact/Hot/Near/Miss) above game grid
        ‚îú‚îÄ‚îÄ GameGrid.tsx             # Responsive card grid: CSS Grid, collapse state management, animated empty state, manages MajorHintModal
        ‚îú‚îÄ‚îÄ GuessCard.tsx            # Individual guess card: header, attribute grid, collapse/expand strip, expandable folded section, major-hint interactions
        ‚îú‚îÄ‚îÄ GameInput.tsx            # Autocomplete input: tag cloud suggestions, keyboard nav, onFocusChange for mobile header collapse
        ‚îú‚îÄ‚îÄ GameOverModal.tsx        # Radix Dialog: always centered, scrollable body with sticky header/footer. Category-specific entity card + Share Result (emoji grid) + Try Free Play / Play Again
        ‚îú‚îÄ‚îÄ HowToPlayModal.tsx       # Radix Dialog: gameplay instructions, auto-opens on first visit (localStorage: scalar-htp-seen); skipped if tutorial runs
        ‚îú‚îÄ‚îÄ MajorHintModal.tsx       # Radix Dialog: confirmation for hint reveal (free with credits, +3 moves without)
        ‚îú‚îÄ‚îÄ PrivacyPolicyModal.tsx   # Radix Dialog: privacy policy with Vercel Analytics disclosure
        ‚îú‚îÄ‚îÄ RevealAnswerModal.tsx    # Radix Dialog: always centered, shows ElementCellCard/CountryDetailCard on forfeit
        ‚îú‚îÄ‚îÄ TutorialOverlay.tsx      # Spotlight tutorial overlay for first-time users: 6-step tour, CSS 4-panel cutout spotlight, auto-positions tooltip, data-tutorial selectors
        ‚îú‚îÄ‚îÄ ScalarLogo.tsx           # Venn diagram SVG logo component
        ‚îú‚îÄ‚îÄ VennBackground.tsx       # Animated decorative background SVG with venn diagram orbs
        ‚îú‚îÄ‚îÄ Scoreboard.tsx           # Header display: CalendarDays icon (daily mode only) + moves count + 3 free hint credit squares (no label)
        ‚îú‚îÄ‚îÄ CountryDetailCard.tsx    # "Passport-style" country card shown in GameOverModal/RevealAnswerModal
        ‚îî‚îÄ‚îÄ ElementCellCard.tsx      # Periodic-table cell card shown in GameOverModal/RevealAnswerModal
```

## Tech Stack
- **React 19** with **TypeScript ~5.9** (strict mode, `noUnusedLocals`, `noUnusedParameters`)
- **Vite 7** for build/dev (`npm run dev` / `npm run build`)
- **Tailwind CSS v4** (uses `@theme inline` syntax in CSS, NOT `tailwind.config.js`)
- **Zustand 5** for state management with localStorage persistence
- **Shadcn/UI** (Radix UI primitives) for base components
- **Lucide React** for icons (Eye, Check, ChevronDown, Share2, X)
- **Vercel Analytics** (`@vercel/analytics`) for privacy-respecting usage analytics (no cookies, daily-reset hash)
- **Fraunces Variable** serif font for display headings (via `@fontsource-variable/fraunces`)
- **Geist Mono** for data, clues, and body text (monospace aesthetic)

## Key Commands
All commands run from repo root:
```bash
npm run dev       # Vite dev server at http://localhost:5173
npm run build     # tsc -b && vite build -> dist/
npm run lint      # ESLint (flat config, v9)
npm run preview   # Preview production build
```

Data fetch (reads CSVs from `data/`, writes `gameData.json`):
```bash
python fetch_data.py
```

## Architecture Pattern (Strict Separation of Concerns)
1. **Types** (`src/types.ts`) - All shared interfaces/types
2. **Pure Logic** (`src/utils/gameLogic.ts`) - Game mechanics as pure functions, NO state mutation
3. **State** (`src/store/gameStore.ts`) - Zustand store calls pure functions, updates state
4. **Components** (`src/components/`) - Consume state via `useGameStore`, render UI

**Data flow**: User action -> Component dispatches store action -> Store calls pure function from gameLogic -> Store updates state -> Components re-render -> localStorage persisted automatically

## Type System (`types.ts`)

### LogicType (how feedback is computed per field)
| LogicType | Purpose | Example Fields |
|-----------|---------|----------------|
| `EXACT_MATCH` | Binary exact equality | Landlocked?, Radioactive, Symbol matches name? |
| `CATEGORY_MATCH` | String match, optionally colored by distance gradient | Continent, Subregion, Phase (STP), Element Family, Block |
| `HIGHER_LOWER` | Numeric comparison with direction + percentage diff | Population, Area, Atomic #, Group, Period, Timezones |
| `GEO_DISTANCE` | Haversine distance between coordinates | Distance (virtual field in Countries) |
| `SET_INTERSECTION` | Intersection of comma-separated lists | Genre, Cast & Crew (when those categories are active) |
| `TARGET` | Entity name (identification only) | Country Name, Element |
| `NONE` | Support/hidden column (not displayed) | Latitude, Longitude, category bucket columns |

### DisplayFormat (how cell values render)
| Format | Rendering |
|--------|-----------|
| `HIDDEN` | Column not displayed in grid |
| `TEXT` | Raw string value |
| `DISTANCE` | Formatted km distance (e.g., "1,234 km") |
| `PERCENTAGE_DIFF` | Direction arrow + tier (e.g., "‚Üë ~25%") |
| `RELATIVE_PERCENTAGE` | Direction arrow + relative % (e.g., "‚Üë +34%") |
| `NUMBER` | Raw numeric value |
| `CURRENCY` | Direction arrow + $-prefixed value |
| `LIST` | Intersection count "X/Y" |
| `ALPHA_POSITION` | Letter character (1‚ÜíA, 2‚ÜíB, ..., 26‚ÜíZ) with horizontal arrow direction |

### UIColorLogic (how cell background is determined)
| Logic | Coloring |
|-------|----------|
| `DISTANCE_GRADIENT` | Green if exact text match, white if miss (for location text fields like Continent/Subregion/Hemisphere) |
| `CATEGORY_MATCH` | Green if exact, gold if linked category matches, white if miss |
| `STANDARD` | Thermal EXACT/HOT/NEAR/MISS colors (green/orange/amber-dashed/white) |
| `NONE` | No special coloring |

### SchemaField Interface
```typescript
interface SchemaField {
    attributeKey: string;         // Column key in entity data
    displayLabel: string;         // Human-readable header label
    dataType: DataType;           // INT, FLOAT, STRING, CURRENCY, BOOLEAN, LIST
    logicType: LogicType;         // How feedback is computed
    displayFormat: DisplayFormat; // How the cell renders
    isFolded: boolean;            // Placed in expandable "More clues" section (no penalty)
    isVirtual: boolean;           // Computed field (e.g., distance_km)
    linkedCategoryCol?: string;   // Category column for HIGHER_LOWER status coloring
    uiColorLogic?: UIColorLogic;  // Override cell color logic
}
```

### Feedback Interface
```typescript
interface Feedback {
    direction: FeedbackDirection;     // UP, DOWN, EQUAL, NONE
    status: FeedbackStatus;           // EXACT, HOT, NEAR, MISS
    value: string | number | boolean; // Raw guess value
    displayValue?: string;            // Formatted display string
    distanceKm?: number;              // For GEO_DISTANCE / DISTANCE_GRADIENT
    percentageDiff?: number;          // For HIGHER_LOWER (symmetric ratio-based)
    categoryMatch?: boolean;          // For linked category coloring
    matchedItems?: { text: string; isMatch: boolean }[]; // For SET_INTERSECTION per-item match status
}
```

## Component Details

### App.tsx
- Derives `CATEGORIES` from `gameData.categories` keys (currently: `countries`, `elements`)
- Renders **sticky header** (`sticky top-0 z-40`, `bg-paper-white/95 backdrop-blur-sm`) with: `CategoryToggle` + `ModeToggle` (left column), GameInput (center), Scoreboard + `?` button (right)
- **Mobile layout**: stacked rows (CategoryToggle + ModeToggle stacked, input, scoreboard+HTP button), all centered; title area and top two toggle rows collapse (`max-h-0 opacity-0`) when input is focused
- **Desktop layout**: single row ‚Äî CategoryToggle + ModeToggle stacked on left, absolutely centered input, Scoreboard + `?` on right. Header has `border-b-2 border-charcoal` (not venn gradient)
- **Mobile header**: `border-b-venn` gradient underline; title div animates to `h-0` on input focus
- `isInputFocused` state managed, passed to `<GameInput onFocusChange={setIsInputFocused} />`
- "How to Play" is a `?` icon button (`w-7 h-7 border border-charcoal`) with an orange pulse dot (`animate-pulse bg-thermal-orange rounded-full`) for new visitors (cleared when HTP modal is opened once; also cleared when tutorial completes)
- Win effect: briefly adds `invert` class to `<html>` on SOLVED status (200ms delay, 500ms invert)
- **Answer section**: `border-t-2 border-charcoal`, flex row on md. Shows `??????` while PLAYING, reveals **full name** (no truncation) when SOLVED/REVEALED. "Reveal Answer" button shows inline confirm UI (`showRevealConfirm` state) ‚Äî "End your game?" + "Yes, Reveal" / "Cancel" ‚Äî before calling `revealAnswer()`.
- **`ColorLegend`** rendered above `<GameGrid />` at all times
- **Challenger banner**: When `challengerMoves !== null && gameStatus === 'PLAYING'`, a small banner renders above ColorLegend: "Your friend solved this in N moves. Can you beat them?"
- **Footer**: "Built by Samir Husain" link (samirhusain.info) + "Privacy Policy" button + "Submit Feedback" Google Form link
- **Share button**: fixed bottom-right, shows `shareCopied ? 'Copied!' : 'Share'`; **auto-hides** when scrolled down >10px (`translate-y-24`), reappears on scroll up, always visible when SOLVED. Encodes `moves` in challenge hash: `encodeChallenge(category, id, moves)`.
- **Vercel Analytics**: `<Analytics debug={import.meta.env.DEV} />` component at root level
- **Tutorial system**: `tutorialStep: number | null` state (from localStorage check). If `tutorialStep === 0` on mount, switches to freeplay + resets before `initializeApp()` to prevent polluting daily slot. `TUTORIAL_KEY = 'scalar-tutorial-seen'`. `completeTutorial()` writes both `TUTORIAL_KEY` and `HTP_STORAGE_KEY` to localStorage. HTP modal only opens if `tutorialSeen && !htpSeen`. `TutorialOverlay` rendered at root level when `tutorialStep !== null`.

### GameGrid.tsx
- Responsive CSS Grid container: `grid-cols-1` (mobile), `md:grid-cols-2` (tablet), `xl:grid-cols-3` (desktop)
- Uses `getDisplayColumns()` from schemaParser to get visible fields
- Renders `GuessCard` components for each guess, most recent first (reversed order)
- **Collapse state management**: `collapsedByStableId` Map (keyed by stable guess index, never shifts). Auto-collapses the guess that slides into 4th position when a new guess is submitted; respects manual overrides. Map cleared on game reset.
- **Auto-collapse rule**: 3 most recent cards stay expanded; cards at position 4+ are auto-collapsed on the next submit.
- **Animated empty state**: "Make a Guess" heading (Fraunces serif, opacity-20) + bouncing arrow SVG with "Type above" label. Fades out (transition-opacity 300ms) then unmounts (350ms delay) when first guess arrives.
- Passes `collapsed`, `onToggleCollapse`, `isNew` props to each GuessCard
- Manages `MajorHintModal` confirmation state (pendingMajorHint accepts `string | string[]`)

### GuessCard.tsx
- Props: `guess`, `feedback`, `displayFields`, `majorHintAttributes`, `targetEntity`, `guessIndex`, `index`, `gameStatus`, `onRevealMajorHint`, `isNew`, `collapsed`, `onToggleCollapse`
- **`isNew`**: triggers `animate-card-enter` (slide down 16px + fade in, 0.25s ease-out)
- **Collapse/expand**: When `collapsed=true`, renders a **summary strip** ‚Äî a row of colored squares (one per visible field: green=EXACT, orange=HOT, amber=NEAR, white=MISS) + ChevronDown, clickable to re-expand. When expanding from collapsed, body uses `card-body-enter` animation (max-height 0‚Üí800px, 0.2s).
- **Header**: Entity name (bold uppercase, left) + guess index `#03` format (right) + collapse chevron (mobile only, rotated 180¬∞ = pointing up)
- **Card opacity/scale**: idx=0 ‚Üí 100%, idx=1 ‚Üí 95%, idx‚â•2 ‚Üí 85% opacity + `scale-[0.99]`
- **Main grid**: `grid grid-cols-2 gap-px bg-charcoal` ‚Äî non-folded attributes with thin internal dividers
- **Merged Location cell**: Continent, Subregion, Hemisphere merged into a single col-span-2 row. Label: "Location". All exact = green bg. Partial = white bg with green text on matches, opacity-50 on misses. Hint reveals all 3 at once.
- **HIGHER_LOWER cells**: Split layout ‚Äî value on left (`text-base font-bold`), arrow+tier on right (`renderSecondaryText` renders arrow larger than tier label). Year fields use year diff tiers (~5 yrs, ~15 yrs, etc.). ALPHA_POSITION renders A-Z letter with horizontal arrows only.
- **TruncatableText**: CATEGORY_MATCH cells >14 chars (subregion >16 chars) truncate with `‚Ä¶` and expand on tap/click.
- **List (SET_INTERSECTION)**: Full-width (col-span-2) rows. Per-item match coloring. Cast & Crew (`Credits` key) shows matched items only; hidden entirely if no matches.
- **N/A handling**: Missing values (-1, null, empty) render as "N/A" in gray italic on white bg.
- **Conservation status**: IUCN codes expanded to full labels via `expandConservationStatus()`
- **ALPHA_POSITION**: Numeric values (1-26) rendered as letters (A-Z) with horizontal arrows (‚Üê/‚Üí)
- **Scrabble score**: Displayed as "14 pts" or "14 pts ¬∑ 2w" for multi-word names
- **Animal units**: `UNIT_MAP` ‚Äî weight_kg ‚Üí " kg", height_cm ‚Üí " cm", lifespan_years ‚Üí " yrs", speed_kmh ‚Üí " km/h"
- **Olympics Hosted**: Merges hosted count with latest year in format "3 (2020)". Custom amber coloring when last years within 8 years.
- **Eye icon behavior**: Mobile ‚Äî always visible at `opacity-50`. Desktop ‚Äî hidden (`md:opacity-0`) until cell hover (`md:group-hover:opacity-70`), shows "Reveal" tooltip. Larger tap target: `w-7 h-7` button with `p-1.5`.
- **Hinted cells**: Show inverted target value badge (bg-charcoal text-paper-white, Check icon)
- **Expandable section**: Folded attributes (`isFolded: true`) in collapsible "More clues"/"Hide clues" section.
- Uses `getCellColor()` from `feedbackColors.ts` for all color logic
- Card aesthetic: `border border-charcoal bg-paper-white`, no shadows, no rounded corners
- `LIST_FIELD_KEYS = ['Credits', 'Genre']` ‚Äî attribute keys for full-width list rows
- `LOCATION_KEYS = ['hemisphere', 'continent', 'subregion']` ‚Äî merged into Location cell

### GameInput.tsx
- Autocomplete with downward-opening tag cloud suggestions (with small rotated-square caret)
- Keyboard navigation: ArrowUp/Down to navigate, Enter to select, Escape to close
- Disabled with "Solved" or "Revealed" placeholder when game is SOLVED or REVEALED
- Suggestions limited to 8 items, deduplicated by name
- Underline-style input: `border-0 border-b-2 border-b-charcoal`, no box, `bg-transparent`, `px-0`
- Width: `w-48 md:w-72 lg:w-80`
- `onFocusChange?: (focused: boolean) => void` prop ‚Äî called on focus/blur to collapse mobile header rows
- On focus: `window.scrollTo({ top: 0, behavior: 'smooth' })`

### GameOverModal.tsx
- Radix Dialog ‚Äî **always centered**, `w-[95vw] max-w-md`, `max-h-[85dvh] flex flex-col`
- Props: `isOpen`, `targetEntity`, `moves`, `activeCategory`, `activeMode`, `guesses`, `schema`, `dailyMeta?`, `dateString`, `onReset`, `onSwitchToFreePlay`, `onDismissDaily`
- Overlay click **can** close this modal; in daily mode calls `onDismissDaily()` (not `onReset()`) to avoid un-closeable modal bug
- **Sticky header**: "Puzzle Complete" title (charcoal banner, Fraunces serif) + Close button (`<X>`)
- **Scrollable body**: `flex-1 overflow-y-auto p-4`
- **Daily badge**: `DAILY ¬∑ MM/DD` pill (`bg-charcoal text-paper-white font-mono text-[10px]`) shown at top of body when `activeMode === 'daily'`
- **Category-specific entity display**:
  - `elements` ‚Üí renders `<ElementCellCard>` (periodic table square with data panel)
  - `countries` ‚Üí renders `<CountryDetailCard>` (passport-style card with data grid)
  - Other ‚Üí entity name text (+ `targetEntity.image` if present)
- Shows total moves count (`text-3xl font-black X Moves`)
- **Daily streak**: `üî• N day streak ¬∑ Best: N` shown below moves (daily mode only, when `streak > 0`)
- **Sticky footer** (`shrink-0 p-4 border-t border-charcoal/20`):
  - **"Share Result"** (primary, both modes): calls `generateShareText()` for Wordle-style emoji grid; uses Web Share API or clipboard; shows "Copied!" for 2s; tracks `challenge_shared` analytics event
  - **"Try Free Play ‚Üí"** (daily mode): calls `onSwitchToFreePlay()`
  - **"Play Again"** (freeplay mode): calls `onReset()`
  - **Submit Feedback** link (both modes): small text link at bottom

### RevealAnswerModal.tsx
- Radix Dialog: **always centered** on all screen sizes (no bottom-sheet), `w-[95vw] max-w-sm md:max-w-md`
- Props: `isOpen`, `targetEntity`, `schema`, `activeMode`, `onNewGame`, `onSwitchToFreePlay`, `onDismissDaily`
- Title: "Answer Revealed" (charcoal banner, Fraunces serif)
- **Category-specific entity display** (same as GameOverModal): `elements` ‚Üí `<ElementCellCard variant="modal">`, `countries` ‚Üí `<CountryDetailCard variant="modal">`, other ‚Üí entity name
- **Daily forfeit note**: `"Streak not credited on forfeit"` in muted mono text (daily mode only)
- Scrollable body: `overflow-y-auto max-h-[70vh] p-4`
- Footer button pinned to bottom (`border-t border-charcoal`):
  - Daily mode: **"Try Free Play ‚Üí"** calls `onSwitchToFreePlay()`
  - Freeplay mode: **"New Game"** calls `onNewGame()`
- Overlay/X close behavior: daily ‚Üí `onDismissDaily()`, freeplay ‚Üí `onNewGame()`
- Tracks `game_forfeit` analytics event on open (once per open, via `hasFiredRef`)

### HowToPlayModal.tsx
- Auto-opens on first visit (localStorage key: `scalar-htp-seen`)
- Always centered, `w-[95vw] max-w-2xl`, `max-h-[85vh] flex flex-col`
- **Sticky header**: "How to Play" title (charcoal bg) + Close `<X>` button
- **Scrollable body**: `overflow-y-auto flex-1`
- Sections:
  1. **Intro** ‚Äî left-border block: "A mystery entity is chosen at random. Guess to get clues..."
  2. **Reading a Guess Card** ‚Äî mini example card (Brazil) showing: Location (partial match), Distance, Population (HOT ‚Üë ~5√ó), Landlocked (EXACT), Area (‚Üì ~50%), Govt. Type; with annotation swatches below
  3. **Cell Colors** ‚Äî 4 thermal swatches (Exact/Hot/Near/Miss) in a 2√ó4 or 4-col grid
  4. **Direction & Proximity** ‚Äî ‚Üë/‚Üì arrow pills + `‚Üí Later in alphabet` pill; proximity tier strip (~10% ‚Üí ~100√ó) with gradient and "‚Üê Closer / Further ‚Üí" labels
  5. **Scoring & Hints** ‚Äî move costs table + hint credits row with credit squares + Eye icon description
- **"Got It" button** ‚Äî inline at end of scrollable content (not a sticky footer)
- `SectionHeading` helper component for consistent section heading style

### MajorHintModal.tsx
- Confirmation dialog for hint reveal
- Shows dynamic cost: "free" if credits available (with count), "+3 moves" otherwise
- Buttons: Cancel, Reveal (Free) / Reveal (+3)
- Always centered, `max-w-sm`

### PrivacyPolicyModal.tsx
- Radix Dialog: always centered, `max-w-2xl`
- Sections: Information We Collect (local storage, Vercel Analytics), Information We Do Not Collect, Third-Party Services, Data Retention, Contact
- "Got It" close button, matches modal design system

### Scoreboard.tsx
- Inline in header
- Displays: `CalendarDays` icon (size 12, shown only in daily mode) + "Moves" label + count (tabular-nums), graphite divider, 3 credit squares (filled if credit available, empty if spent) ‚Äî **no "Hints" label**

### CountryDetailCard.tsx
- "Passport-style" country reveal card shown in GameOverModal when category is `countries`
- **Passport header**: country name (Fraunces serif `font-light`), location breadcrumb (Hemisphere ‚Ä¢ Continent ‚Ä¢ Subregion), capital city with ‚óâ prefix, ISO code watermark (top-right, large, 12% opacity)
- **Data grid**: 3-column grid with 14 fields: Area, Population, Pop. Density, GDP, GDP/Capita, Armed Forces, Landlocked?, Driving Side, Govt. Type, Timezones, Borders, Olympics Hosted, Last Olympics, UNESCO Sites
- Integer-verbatim fields (timezones, borders, olympics, unesco) shown as raw integers; `zeroAsDash` fields show "‚Äî" when 0

### ElementCellCard.tsx
- Periodic table cell card shown in GameOverModal when category is `elements`
- **Periodic table square**: Atomic # (top-left, `text-lg font-black`), Atomic Mass (top-right, `text-[11px]`), chemical Symbol (center, `text-7xl font-black`), element name (below, `text-xs uppercase tracking-[0.2em]`), Family ¬∑ Block ¬∑ Phase subtitle (`text-[10px]`)
- **Data panel**: 3-column grid with 17 fields (Group, Period, Year Discovered, Radioactive, Synthetic, Symbol matches name?, Classification, Rarity, Conductivity, Density, Electronegativity, Atomic Radius, Ionization Energy, Electron Affinity, Neutrons, Melt Point, Boil Point)
- `border-2 border-charcoal`, `max-w-[340px] mx-auto`

## Store (gameStore.ts)

**Slot-based architecture** ‚Äî state is keyed by `(mode, category)` pairs. Flat top-level fields are a projection of the active slot for backward compatibility with all existing components.

```
Persisted (nested slots):
  activeCategory: string                  (default: 'countries')
  activeMode: 'daily' | 'freeplay'        (default: 'daily')
  daily: Record<string, GameSlot>         (keyed by category; GameSlot has dailyDate for rollover detection)
  freeplay: Record<string, GameSlot>      (keyed by category)
  dailyMeta: Record<string, DailyMeta>    (streak tracking per category)

Flat projection of active slot (auto-synced via syncFlat(), backward-compatible):
  targetEntity: Entity
  guesses: GuessResult[]
  gameStatus: 'PLAYING' | 'SOLVED' | 'REVEALED'
  moves: number                           (total moves count, lower is better)
  credits: number                         (free hint credits, default: 3)
  majorHintAttributes: string[]           (tracks which attrs have been major-hinted)

Actions:
  setActiveMode(mode)        -> switch between daily/freeplay; loads or creates appropriate slot
  setActiveCategory(cat)     -> switch category (guard: no-op if same); loads or creates appropriate slot
  initializeApp()            -> handle day rollovers, sync flat state; called from onRehydrateStorage + App mount
  submitGuess(entity)        -> compute feedback, +1 move, check win; on SOLVED: updates streak (daily) + tracks analytics
  revealMajorHint(attr|attr[]) -> reveals exact target value; uses 1 credit if available (0 moves), else +3 moves
  revealAnswer()             -> forfeit: status=REVEALED; daily streak stalls (not broken), no dailyMeta update
  resetGame()                -> freeplay only (daily is a no-op): new random target, clear guesses, reset moves/credits
  startChallengeGame(cat, entity) -> always switches to freeplay mode with exact category+target
```

Persisted to localStorage under key `scalar-game-storage` (**version 14** ‚Äî bumping triggers migration that clears stale state).

**Internal helpers** (not exported):
- `makeDefaultSlot(entity)` ‚Äî creates a fresh GameSlot
- `syncFlat(slot)` ‚Äî returns flat fields from a GameSlot (for backward compat projection)
- `writeSlot(state, mode, category, slot)` ‚Äî updates nested slot AND syncs flat fields in one `set()` call
- `getOrInitDailySlot(daily, category, today)` ‚Äî returns existing slot if `dailyDate === today`, else creates fresh one
- `getOrInitFreeplaySlot(freeplay, category)` ‚Äî returns existing or creates fresh freeplay slot
- `_updateDailyStreak(category, today)` ‚Äî internal closure; increments streak if yesterday was last completed, else resets to 1
- `yesterdayFrom(dateString)` ‚Äî computes `YYYY-MM-DD` of the local-timezone previous day

**No `revealColumn` or `revealFoldedAttribute` actions** ‚Äî all reveals go through `revealMajorHint`. Column visibility is always fully visible.

## Game Logic (gameLogic.ts) ‚Äî Feedback Engine

The feedback system uses a **dispatch pattern** based on each field's `logicType`:

```
getFeedback(target, guess, schema)
  ‚îú‚îÄ‚îÄ Pre-computes haversine distance (for DISTANCE_GRADIENT fields)
  ‚îî‚îÄ‚îÄ For each schema field (skipping TARGET and NONE):
      ‚îú‚îÄ‚îÄ EXACT_MATCH    ‚Üí handleExactMatch()
      ‚îú‚îÄ‚îÄ CATEGORY_MATCH ‚Üí handleCategoryMatch()
      ‚îú‚îÄ‚îÄ HIGHER_LOWER   ‚Üí handleHigherLower()
      ‚îú‚îÄ‚îÄ GEO_DISTANCE   ‚Üí handleGeoDistance()
      ‚îî‚îÄ‚îÄ SET_INTERSECTION ‚Üí handleSetIntersection()
```

### Handler Functions

| Handler | Logic | Status Rules |
|---------|-------|-------------|
| `handleExactMatch` | Binary equality (case-insensitive strings, boolean‚ÜíYes/No) | EXACT or MISS |
| `handleCategoryMatch` | String equality; attaches `distanceKm` when `uiColorLogic === 'DISTANCE_GRADIENT'` | EXACT or MISS |
| `handleHigherLower` | Numeric comparison; symmetric `percentageDiff` = (max/min ‚àí 1)√ó100; checks `linkedCategoryCol` for status; builds displayValue by `displayFormat` | EXACT (equal), HOT (linked category matches), MISS |
| `handleGeoDistance` | Pre-computed haversine distance in km | EXACT (0km), HOT (<1000km), NEAR (<3000km), MISS (‚â•3000km) |
| `handleSetIntersection` | Comma-separated list intersection-over-union ratio | EXACT (1.0), HOT (>0.5), NEAR (>0), MISS (0) |

### Supporting Utilities

**feedbackColors.ts:**
| Function | Purpose |
|----------|---------|
| `getGeoDistanceCellClass(distanceKm)` | green (<1000km), amber (<3000km), yellow (<5000km), white (‚â•5000km) |
| `getCategoryMatchClass(categoryMatch)` | `bg-cat-match` (gold) or `bg-white text-charcoal` |
| `getStandardStatusClass(status)` | green (EXACT), orange (HOT), amber-dashed (NEAR), white (MISS) |
| `getCellColor(feedback, field)` | Composite dispatcher by `uiColorLogic` and feedback |

**formatters.ts ‚Äî Tier Labels:**
| Function | Output tiers |
|----------|-------------|
| `formatPercentageDiffTier(percentDiff)` | Exact ‚Üí ~10% ‚Üí ~25% ‚Üí ~50% ‚Üí **~2√ó ‚Üí ~5√ó ‚Üí ~10√ó ‚Üí ~50√ó ‚Üí ~100√ó** |
| `formatYearDiffTier(absDiff)` | Exact ‚Üí **~5 yrs ‚Üí ~15 yrs ‚Üí ~30 yrs ‚Üí 30+ yrs** |

**Other utilities:** `formatNumber()`, `formatDistance()`, `expandConservationStatus()`, `getDirectionSymbol()`, `getAlphaDirectionSymbol()`, `numberToLetter()`

**challengeUtils.ts:** `encodeChallenge(categoryId, entityId, moves?)` / `decodeChallenge(hash)` ‚Äî Base64 `{c, i, m?}` JSON. `m` (moves) is optional; included when sharing a completed game so the challenger can see the score to beat. `decodeChallenge` returns `{ category, entity, challengerMoves? }`.

**dailyUtils.ts:** `getLocalDateString()`, `formatDateLabel()`, `formatToggleDateLabel()`, `getPuzzleNumber(dateString)` (sequential puzzle # since epoch 2026-02-25), `getDailyEntity()`, `generateShareText()`. Share text format: `SCALAR Daily #N (M/DD) ‚Ä¢ üåç Category ‚Ä¢ N Moves` (daily) / `SCALAR ‚Ä¢ üåç Category ‚Ä¢ N Moves` (freeplay). Daily URL = `https://scalargame.com` (no challenge hash to avoid spoiling). Freeplay URL includes challenge hash with moves encoded.

**tutorialConfig.ts:** exports `TUTORIAL_STEPS: TutorialStep[]` (6 steps: welcome, controls, legend, hints, answer, done). Each step has `id`, `title`, `body`, `targetSelector` (null = centered), `tooltipPosition`, optional `showEyeIcon`, `nextLabel`, `skipHidden`.

**analytics.ts:** `trackGameEvent(name, data)` ‚Äî tracks `game_completed` (category, moves, used_hints), `challenge_shared` (category, moves), and `game_forfeit` (category)

**geo.ts:** `haversineDistance(lat1, lon1, lat2, lon2)` ‚Äî great-circle km

**schemaParser.ts:** `getDisplayColumns()`, `getFoldedColumns()`, `getVisibleCandidateColumns()`, `getFieldByKey()`

## Scoring System (Total Moves)
- **+1 move** per guess submitted
- **Hints** (Eye icon on any attribute): Free if credits > 0 (consumes 1 credit), else **+3 moves**
- **Free hint credits**: 3 per game (displayed as filled squares in Scoreboard)
- **Forfeit**: Reveal Answer (after inline "End your game?" confirmation) ends game as REVEALED; moves are NOT modified ‚Äî moves stay at whatever was accumulated before forfeit

## Hint System
All non-folded display columns are visible by default. The only hint mechanism is the **Eye icon** (triggers `revealMajorHint`).

- Eye icon on ALL cells, top-right corner (`w-7 h-7` button, `p-1.5` tap target)
- Mobile: always visible at `opacity-50`. Desktop: hidden (`md:opacity-0`) until cell hover, shows "Reveal" tooltip
- Only visible while PLAYING
- Clicking opens MajorHintModal for confirmation + cost display
- Location cell hint reveals all 3 location attributes at once for a single credit/cost
- Once revealed: inverted badge (bg-charcoal text-paper-white + Check icon) shows target value
- Hint state persisted in `majorHintAttributes` array in store

### Folded Attributes
- Schema fields with `isFolded: true` appear in a collapsible "More clues" section
- **Currently: neither active category (countries, elements) has folded fields** ‚Äî the section never renders
- Folded reveals would use the same revealMajorHint credit/moves logic

## Design System Rules
- **"Thermal E-Paper / Scientific Journal"** aesthetic
- Background: `#FAFAF9` (paper-white), Foreground: `#18181B` (charcoal), Structural borders: `#E2E8F0` (graphite)
- **Sharp corners** (`--radius: 0px`), thin 1px borders
- **Typography**: Fraunces Variable serif (`font-serif-display`) for headings, Geist Mono for everything else
- **Thermal feedback**: EXACT=green (#22C55E), HOT=orange (#F97316), NEAR=amber-dashed, MISS=white
- **GEO_DISTANCE**: green (<1000km) ‚Üí amber (<3000km) ‚Üí yellow (<5000km) ‚Üí white (‚â•5000km)
- **DISTANCE_GRADIENT**: green (exact text match) / white (miss) ‚Äî binary
- **Category match**: green (exact) / gold (bucket match) / white (miss)
- **Hard-edge shadows**: `shadow-hard` (6√ó6px), `shadow-hard-sm` (4√ó4px) ‚Äî no blurs
- **Buttons**: invert on hover; **Input**: underline-style (bottom border only)

## CSS Custom Utilities (index.css)
```
bg-geo-warm          ‚Äî #F59E0B (Amber), charcoal text ‚Äî distance <3000km
bg-geo-yellow        ‚Äî #FACC15 (Yellow), charcoal text ‚Äî distance <5000km
bg-cat-match         ‚Äî #EAB308 (Gold), charcoal text ‚Äî category bucket match
font-serif-display   ‚Äî Fraunces Variable serif
shadow-hard          ‚Äî 6px 6px hard-edge shadow (modals)
shadow-hard-sm       ‚Äî 4px 4px hard-edge shadow (dropdowns)
border-b-venn        ‚Äî teal‚Üígold‚Üípink gradient underline (mobile header)
animate-glow         ‚Äî subtle gold box-shadow pulse (2s loop)
.animate-card-enter  ‚Äî new guess slide-in (translateY -16px‚Üí0, opacity 0‚Üí1, 0.25s)
.card-body-enter     ‚Äî expand-from-collapsed animation (max-height 0‚Üí800px, 0.2s)
.animate-bounce-up   ‚Äî empty-state arrow bounce (translateY oscillation, 2s loop)
```

## Tailwind Color Tokens (`@theme inline`)
```
paper-white: #FAFAF9   charcoal: #18181B    graphite: #E2E8F0
thermal-green: #22C55E thermal-orange: #F97316
```
Note: `thermal-amber` (`#F59E0B`), `thermal-gold` (`#EAB308`), geo-distance colors, and category match colors are implemented as `@utility` classes (not Tailwind tokens) in index.css.

## Data Pipeline

### CATEGORY_MAP (fetch_data.py ‚Äî currently active)
```python
CATEGORY_MAP = {
    "countries": {
        "schema": "countries_schema_config.csv",
        "data":   "countries_enriched.csv",
    },
    "elements": {
        "schema": "elements_schema_config.csv",
        "data":   "elements_enriched.csv",
    },
}
```

### Adding a New Category
1. Create `data/{category}_schema_config.csv`
2. Create `data/{category}_enriched.csv`
3. Add entry to `CATEGORY_MAP` in `fetch_data.py`
4. Run `python fetch_data.py`
5. UI auto-discovers ‚Äî no component code changes needed (consider adding a category-specific win card to GameOverModal)

## Category Schemas

### Countries
Active (visible in game grid) ‚Äî no folded fields:

| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Continent | CATEGORY_MATCH | TEXT | `uiColorLogic: DISTANCE_GRADIENT` (green/white binary) |
| Subregion | CATEGORY_MATCH | TEXT | `uiColorLogic: DISTANCE_GRADIENT` |
| Hemisphere | CATEGORY_MATCH | TEXT | `uiColorLogic: DISTANCE_GRADIENT` |
| Distance from Target | GEO_DISTANCE | DISTANCE | Virtual field, haversine km between capitals |
| Area (sq km) | HIGHER_LOWER | PERCENTAGE_DIFF | Linked to area_cat |
| Population | HIGHER_LOWER | PERCENTAGE_DIFF | Linked to population_cat |
| Landlocked? | EXACT_MATCH | TEXT | Yes/No |
| Govt. Type | CATEGORY_MATCH | TEXT | government_type |
| Borders | HIGHER_LOWER | NUMBER | border_countries_count |
| Timezones | HIGHER_LOWER | NUMBER | Linked to timezone_cat |
| 1st Letter | HIGHER_LOWER | ALPHA_POSITION | first_letter (1-26 ‚Üí A-Z with ‚Üê/‚Üí) |

Hidden/inactive: gdp_per_capita, Armed Forces, driving_side, pop_density, olympics_hosted_count, olympics_latest_year, GDP, unesco_sites, and all `*_cat` support columns.

### Elements
Active (visible in game grid) ‚Äî no folded fields:

| Attribute | Logic Type | Display Format | Notes |
|-----------|-----------|----------------|-------|
| Atomic # | HIGHER_LOWER | NUMBER | AtomicNumber |
| Group | HIGHER_LOWER | NUMBER | Linked to GroupBlock |
| Period | HIGHER_LOWER | NUMBER | |
| Phase (STP) | CATEGORY_MATCH | TEXT | StandardState: Solid, Liquid, Gas |
| Element Family | CATEGORY_MATCH | TEXT | element_family |
| Block | CATEGORY_MATCH | TEXT | s/p/d/f block |
| Radioactive | EXACT_MATCH | TEXT | is_radioactive; Yes/No |
| Symbol matches name? | EXACT_MATCH | TEXT | symbol_match; Yes/No |

Hidden (HIDDEN display format ‚Äî not shown in game grid, shown in ElementCellCard on win): AtomicMass, Density, MeltingPoint, BoilingPoint, Electronegativity, AtomicRadius, IonizationEnergy, ElectronAffinity, rarity_category, YearDiscovered, is_synthetic, neutron_count, conductivity_type, broad_classification.

## Important Gotchas
- `credentials.json` is gitignored - needed only for legacy Google Sheets access
- No test framework configured - `gameLogic.ts` pure functions are the best candidates for unit tests
- localStorage keys: `scalar-game-storage` (game state, **version 14**), `scalar-htp-seen` (HTP modal), `scalar-tutorial-seen` (tutorial seen flag; value is `'1'` on complete, `'skipped'` on skip)
- **Store version is 14** ‚Äî bumping triggers migration that clears stale localStorage
- No difficulty modes ‚Äî single difficulty with Total Moves scoring
- Game status flow: PLAYING ‚Üí SOLVED (win) or PLAYING ‚Üí REVEALED (forfeit)
- `linkedCategoryCol` fields (logicType: NONE, displayFormat: HIDDEN) drive HIGHER_LOWER status coloring
- Virtual fields (`isVirtual: true`) like `distance_km` are computed at feedback time, not stored in entity data
- **No `revealColumn` or `revealFoldedAttribute`** actions ‚Äî all hints use `revealMajorHint`
- **Neither active category has folded fields** ‚Äî "More clues" section never renders currently
- Percentage diff uses **symmetric ratio** (max/min ‚àí 1) ‚Äî both UP and DOWN give same tier magnitude
- Year diff tiers: ~5 yrs, ~15 yrs, ~30 yrs, 30+ yrs (not the old ¬±2/¬±5/¬±10 scale)
- `revealAnswer()` sets `gameStatus = 'REVEALED'`; moves are NOT modified; it does NOT update `dailyMeta` (streak stalls, not broken)
- `resetGame()` is a **no-op in daily mode** ‚Äî daily slots are locked once SOLVED/REVEALED
- **Daily modal dismissal**: `gameStatus` stays `SOLVED` permanently in daily mode. `App.tsx` uses `dailyGameOverDismissed` / `dailyRevealDismissed` session state to allow closing the modal; these flags reset on mode/category switch.
- **Reveal Answer confirmation**: "Reveal Answer" button sets `showRevealConfirm = true`, showing inline "End your game? / Yes, Reveal / Cancel" UI ‚Äî prevents accidental forfeit. `showRevealConfirm` is cleared on `handleReset()`.
- **Tutorial always runs in freeplay**: On mount if `tutorialStep === 0`, App switches to freeplay and resets before `initializeApp()` to prevent tutorial guesses polluting the daily slot.
- **HTP modal vs Tutorial**: If `scalar-tutorial-seen` exists but `scalar-htp-seen` does not, HTP modal opens automatically. If neither exist, tutorial runs instead. If both exist, neither auto-opens.
- **Day rollover**: Handled in `onRehydrateStorage` ‚Üí `initializeApp()` synchronously before first render. Daily slots with a stale `dailyDate` are replaced.
- **Daily entity selection**: `getDailyEntity()` in `dailyUtils.ts` sorts entities alphabetically by `id` then picks index via Mulberry32 PRNG seeded from `hashString(dateString + ':' + category)`. Sort ensures stability even if gameData.json entity order changes.
- **Puzzle numbering**: `getPuzzleNumber(dateString)` in `dailyUtils.ts`. Epoch = 2026-02-25 (day before launch). Puzzle #1 = 2026-02-26.
- **Challenge URL with moves**: `encodeChallenge(category, id, moves)` encodes `{c, i, m}`. `decodeChallenge` returns `challengerMoves` which App stores in `challengerMoves` state and shows in a banner.
- GameOverModal **can** be dismissed by clicking the overlay (no `onInteractOutside` prevention)

## Game Concepts Reference
- **Categories**: `countries`, `elements` (auto-discovered from `gameData.json`)
- **Game Modes**: `daily` (one puzzle per day per category, locked after solved) / `freeplay` (unlimited, random target)
- **Daily entity**: Deterministic via Mulberry32 PRNG seeded from date + category. Same puzzle for all users on same calendar day (local timezone).
- **Logic types**: EXACT_MATCH, CATEGORY_MATCH, HIGHER_LOWER, GEO_DISTANCE, SET_INTERSECTION, TARGET, NONE
- **Feedback statuses**: EXACT, HOT, NEAR, MISS
- **Feedback directions**: UP (target higher), DOWN (target lower), EQUAL, NONE
- **Hints**: Eye icon on any cell ‚Üí revealMajorHint ‚Üí free (credit) or +3 moves
- **Challenge Mode**: `?challenge=` query param, Base64 `{c, i, m?}` JSON, decoded on mount, triggers `startChallengeGame` (always freeplay). Optional `m` = challenger's move count, shown in banner.
- **Win condition**: All feedback fields EXACT
- **Forfeit**: REVEALED state; moves unchanged; in daily mode streak stalls (not broken). Requires inline "End your game?" confirmation before executing.
- **Daily Streak**: Incremented only on SOLVED (not REVEALED). Streak breaks if a day is skipped. `dailyMeta` persisted per category.
- **Game Over**: Always-centered modal with category-specific entity card (ElementCellCard / CountryDetailCard)
- **Share (GameOverModal)**: "Share Result" button generates Wordle-style emoji grid text. Daily header: `SCALAR Daily #N (M/DD) ‚Ä¢ üåç Countries ‚Ä¢ N Moves`. Freeplay header: `SCALAR ‚Ä¢ üåç Countries ‚Ä¢ N Moves`. >6 guesses: first 3 rows + `...` + last row. Daily URL = `https://scalargame.com` (no hash). Freeplay URL = challenge hash with moves encoded.
- **Share (fixed button, bottom-right)**: Generates challenge URL with moves encoded. Shows "Copied!" feedback for 2s. Auto-hides on scroll down >10px.
- **Tutorial**: 6-step interactive spotlight tour for first-time users. Steps: welcome (centered), controls (header), legend (color-legend), hints (centered + Eye demo), answer (answer-section), done (centered). Runs in freeplay. `scalar-tutorial-seen` localStorage key.

## Common Task Patterns

### Adding a new game mechanic
1. Add pure function to `src/utils/gameLogic.ts`
2. Add state/action to `src/store/gameStore.ts`
3. Consume new state in the relevant component

### Adding a new category
1. Create `data/{category}_schema_config.csv`
2. Create `data/{category}_enriched.csv`
3. Add to `CATEGORY_MAP` in `fetch_data.py`
4. Run `python fetch_data.py`
5. UI auto-discovers ‚Äî optionally add a category-specific win card to GameOverModal

### Adding a new logic type
1. Add to `LogicType` union in `src/types.ts`
2. Create handler in `src/utils/gameLogic.ts`, add case to `getFeedback()`
3. Update `feedbackColors.ts` if new coloring needed
4. Update `GuessCard.tsx` if new cell rendering needed
5. Add CSS utilities to `src/index.css` if needed

### Modifying scoring
- `HINT_MOVE_COST = 3`, `DEFAULT_CREDITS = 3` in `gameStore.ts`
- Each guess adds +1 move in `submitGuess`
